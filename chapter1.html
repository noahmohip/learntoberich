<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chapter 1 — Intro to Accounting & Business | Accounting By Noah</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,700&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0d1117;
      --surface: #161b22;
      --surface2: #1c2333;
      --surface3: #222d3e;
      --border: rgba(255,255,255,.08);
      --border2: rgba(255,255,255,.13);
      --text: #e8edf3;
      --muted: #b8c4d4;
      --muted2: #8b96a8;
      --gold: #d4a843;
      --gold-dim: rgba(212,168,67,.12);
      --green: #2dba7e;
      --green-dim: rgba(45,186,126,.11);
      --green-bright: rgba(45,186,126,.25);
      --red: #f06060;
      --red-dim: rgba(240,96,96,.1);
      --blue: #4f9cf9;
      --radius: 14px;
      --radius-sm: 9px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }

    body {
      font-family: 'DM Sans', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      font-size: 16px;
    }

    /* ===== NAV ===== */
    nav {
      position: sticky;
      top: 0;
      z-index: 100;
      height: 64px;
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 0 32px;
      background: rgba(13,17,23,.9);
      backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border);
    }

    .nav-brand {
      display: flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      color: var(--text);
    }

    .nav-logo {
      width: 38px; height: 38px;
      border-radius: 9px;
      display: grid;
      place-items: center;
      overflow: hidden;
      flex-shrink: 0;
      background: rgba(255,255,255,.03);
      border: 1px solid var(--border);
      box-shadow: 0 0 14px rgba(45,186,126,.16);
    }
    .nav-logo img {
      width: 100%; height: 100%;
      object-fit: contain;
      display: block;
    }

    .nav-brand-text {
      font-family: 'Playfair Display', serif;
      font-size: 15px;
      font-weight: 700;
      line-height: 1.2;
    }

    .nav-brand-text small {
      display: block;
      font-family: 'DM Sans', sans-serif;
      font-size: 10px;
      font-weight: 400;
      color: var(--muted);
      letter-spacing: .04em;
      text-transform: uppercase;
    }

    .nav-spacer { flex: 1; }

    .nav-pill {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 7px 14px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 13px;
      color: var(--muted);
    }

    .nav-pill select {
      border: none;
      background: transparent;
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      outline: none;
      cursor: pointer;
      max-width: 260px;
    }

    .nav-pill select option { background: #1c2333; color: var(--text); }

    .nav-btn {
      padding: 8px 16px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--surface2);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: border-color .15s, background .15s;
      white-space: nowrap;
    }

    .nav-btn:hover { border-color: var(--border2); background: var(--surface3); }

    .nav-btn.green {
      background: var(--green);
      color: #071a10;
      border-color: transparent;
    }

    .nav-btn.green:hover { opacity: .85; }

    /* ===== LAYOUT ===== */
    .wrap {
      display: grid;
      grid-template-columns: 280px 1fr;
      max-width: 1400px;
      margin: 0 auto;
      gap: 24px;
      padding: 24px 24px 80px;
      align-items: start;
    }

    @media (max-width: 920px) {
      .wrap { grid-template-columns: 1fr; }
      .sidebar { display: none; }
    }

    /* ===== SIDEBAR ===== */
    .sidebar {
      position: sticky;
      top: 88px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
    }

    .sidebar-head {
      padding: 20px 18px 16px;
      background: var(--surface2);
      border-bottom: 1px solid var(--border);
    }

    .sidebar-label {
      font-family: 'DM Mono', monospace;
      font-size: 10px;
      font-weight: 500;
      letter-spacing: .1em;
      text-transform: uppercase;
      color: var(--gold);
      margin-bottom: 4px;
    }

    .sidebar-title {
      font-family: 'Playfair Display', serif;
      font-size: 16px;
      font-weight: 700;
      line-height: 1.3;
    }

    .sidebar-sub {
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.5;
    }

    .ch-list { padding: 12px; display: grid; gap: 6px; }

    .ch-btn {
      width: 100%;
      text-align: left;
      border: 1px solid transparent;
      background: transparent;
      padding: 10px 12px;
      border-radius: 9px;
      cursor: pointer;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      transition: background .15s, border-color .15s;
      color: var(--text);
    }

    .ch-btn:hover { background: var(--surface2); border-color: var(--border); }
    .ch-btn.active { background: var(--green-dim); border-color: var(--green-bright); }

    .ch-num {
      width: 30px; height: 30px;
      border-radius: 8px;
      background: var(--surface2);
      display: grid;
      place-items: center;
      font-family: 'DM Mono', monospace;
      font-size: 12px;
      font-weight: 500;
      color: var(--muted);
      flex-shrink: 0;
    }

    .ch-btn.active .ch-num {
      background: var(--green-dim);
      color: var(--green);
    }

    .ch-text b {
      font-size: 13px;
      font-weight: 600;
      line-height: 1.35;
      display: block;
    }

    .ch-text span {
      font-size: 11px;
      color: var(--muted);
      margin-top: 2px;
      display: block;
    }

    .ch-btn.active .ch-text b { color: var(--text); }

    /* ===== MAIN CONTENT ===== */
    .content {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 18px;
      overflow: hidden;
    }

    /* HERO BAND */
    .ch-hero {
      padding: 48px 40px 38px;
      background:
        radial-gradient(700px 280px at 0% 50%, rgba(45,186,126,.09), transparent),
        radial-gradient(600px 260px at 100% 50%, rgba(212,168,67,.07), transparent),
        var(--surface2);
      border-bottom: 1px solid var(--border);
      position: relative;
      overflow: hidden;
    }

    .ch-hero::before {
      content: '';
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(rgba(255,255,255,.018) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,.018) 1px, transparent 1px);
      background-size: 48px 48px;
    }

    .ch-hero-inner { position: relative; z-index: 1; }

    .ch-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-family: 'DM Mono', monospace;
      font-size: 10px;
      font-weight: 500;
      letter-spacing: .1em;
      text-transform: uppercase;
      color: var(--green);
      background: var(--green-dim);
      border: 1px solid rgba(45,186,126,.2);
      padding: 5px 12px;
      border-radius: 999px;
      margin-bottom: 20px;
    }

    .ch-tag::before {
      content: '';
      width: 5px; height: 5px;
      border-radius: 50%;
      background: var(--green);
    }

    .ch-hero h1 {
      font-family: 'Playfair Display', serif;
      font-size: clamp(28px, 4vw, 40px);
      font-weight: 900;
      letter-spacing: -.02em;
      line-height: 1.15;
    }

    .ch-hero p {
      margin-top: 16px;
      color: var(--muted);
      font-size: 15px;
      line-height: 1.75;
      max-width: 760px;
    }

    .ch-hero-actions {
      margin-top: 28px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .jump-btn {
      padding: 9px 18px;
      border-radius: 8px;
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: border-color .15s, background .15s;
      text-decoration: none;
    }

    .jump-btn:hover { border-color: var(--border2); background: var(--surface3); }

    .jump-btn.primary {
      background: var(--green);
      color: #071a10;
      border-color: transparent;
    }

    .jump-btn.primary:hover { opacity: .85; }

    /* ===== SECTIONS ===== */
    .section {
      padding: 36px 40px;
      border-top: 1px solid var(--border);
    }

    .section-title-row {
      display: flex;
      align-items: baseline;
      gap: 14px;
      margin-bottom: 8px;
    }

    .obj-badge {
      font-family: 'DM Mono', monospace;
      font-size: 10px;
      font-weight: 500;
      color: var(--gold);
      letter-spacing: .1em;
      text-transform: uppercase;
      white-space: nowrap;
    }

    .section h2 {
      font-family: 'Playfair Display', serif;
      font-size: 26px;
      font-weight: 900;
      letter-spacing: -.01em;
      line-height: 1.2;
    }

    .section-intro {
      color: var(--muted);
      font-size: 15px;
      line-height: 1.75;
      max-width: 820px;
      margin-top: 10px;
      margin-bottom: 28px;
    }

    /* ===== PROSE DEFINITIONS (replaces box-heavy terms) ===== */
    .terms { display: grid; gap: 0; }

    .term {
      display: grid;
      grid-template-columns: 160px 1fr auto;
      gap: 20px;
      align-items: baseline;
      padding: 14px 0;
      border-bottom: 1px solid var(--border);
    }
    .terms .term:last-child { border-bottom: none; }

    .term-tag {
      font-family: 'DM Mono', monospace;
      font-size: 11px;
      font-weight: 500;
      color: var(--green);
      letter-spacing: .04em;
      padding-top: 1px;
    }

    .term-body {
      font-size: 15px;
      line-height: 1.75;
      color: var(--text);
    }

    .term-body b { color: var(--text); font-weight: 600; }

    /* TOC jump rows */
    .term.toc-link {
      cursor: pointer;
      transition: background .15s, padding-left .15s;
      border-radius: 8px;
      padding: 14px 10px 14px 0;
    }

    .term.toc-link:hover {
      background: rgba(45,186,126,.06);
      padding-left: 10px;
    }

    .term.toc-link:hover .term-tag {
      color: var(--green);
    }

    .term.toc-link:hover .toc-arrow {
      opacity: 1;
      transform: translateY(2px);
    }

    .toc-arrow {
      font-size: 14px;
      color: var(--green);
      opacity: 0;
      transition: opacity .15s, transform .15s;
      flex-shrink: 0;
      align-self: center;
    }

    @media (max-width: 600px) {
      .term { grid-template-columns: 1fr; gap: 4px; }
    }

    /* EQUATION BOX */
    .eq-box {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 16px 20px;
      border: 1px dashed rgba(45,186,126,.3);
      border-radius: 11px;
      background: var(--green-dim);
      margin: 20px 0;
    }

    .eq-box code {
      font-family: 'DM Mono', monospace;
      font-size: 15px;
      font-weight: 500;
      color: var(--green);
    }

    .copy-btn {
      padding: 6px 12px;
      border-radius: 6px;
      background: transparent;
      border: 1px solid rgba(45,186,126,.3);
      color: var(--green);
      font-family: 'DM Mono', monospace;
      font-size: 11px;
      cursor: pointer;
      flex-shrink: 0;
      transition: background .15s;
    }

    .copy-btn:hover { background: var(--green-dim); }

    /* ===== QUIZ ZONES — visually distinct from content ===== */
    .quiz-block {
      background: rgba(212,168,67,.05);
      border: 1px solid rgba(212,168,67,.2);
      border-left: 3px solid var(--gold);
      border-radius: 11px;
      padding: 22px 24px;
      margin-top: 32px;
    }

    .quiz-block::before {
      content: 'Quick Check';
      display: block;
      font-family: 'DM Mono', monospace;
      font-size: 9px;
      font-weight: 500;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--gold);
      margin-bottom: 10px;
    }

    .quiz-label {
      font-size: 15px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 14px;
      line-height: 1.55;
    }

    .quiz-input {
      width: 100%;
      background: var(--surface);
      border: 1px solid rgba(212,168,67,.2);
      border-radius: 8px;
      padding: 11px 14px;
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      font-weight: 400;
      color: var(--text);
      outline: none;
      transition: border-color .15s;
    }

    .quiz-input:focus { border-color: var(--gold); }

    .quiz-row {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .quiz-check-btn {
      padding: 9px 20px;
      border-radius: 8px;
      background: rgba(212,168,67,.15);
      color: var(--gold);
      border: 1px solid rgba(212,168,67,.3);
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
      transition: background .15s;
    }

    .quiz-check-btn:hover { background: rgba(212,168,67,.25); }

    .result-badge {
      display: none;
      padding: 6px 12px;
      border-radius: 6px;
      font-family: 'DM Mono', monospace;
      font-size: 12px;
      font-weight: 500;
    }

    .result-badge.show { display: inline-block; }
    .result-badge.good { background: var(--green-dim); border: 1px solid rgba(45,186,126,.25); color: var(--green); }
    .result-badge.bad { background: var(--red-dim); border: 1px solid rgba(240,96,96,.25); color: var(--red); }
    .result-badge.warn { background: var(--gold-dim); border: 1px solid rgba(212,168,67,.25); color: var(--gold); }

    .quiz-hint {
      font-size: 12px;
      color: var(--muted2);
    }

    /* FLASHCARD */
    .flashcard {
      cursor: pointer;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 36px 28px;
      text-align: center;
      font-family: 'Playfair Display', serif;
      font-size: 18px;
      font-weight: 700;
      line-height: 1.5;
      min-height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 20px;
      user-select: none;
      transition: border-color .2s, background .2s, transform .15s;
    }

    .flashcard:hover { border-color: var(--border2); transform: translateY(-2px); }
    .flashcard.flipped { background: var(--green-dim); border-color: rgba(45,186,126,.3); color: var(--green); }

    /* ===== PROSE CONTENT BLOCKS ===== */
    .gaap-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      margin-top: 28px;
    }

    @media (max-width: 700px) { .gaap-grid { grid-template-columns: 1fr; gap: 24px; } }

    .gaap-card {
      padding: 0 0 0 16px;
      border-left: 2px solid rgba(212,168,67,.4);
    }

    .gaap-card-label {
      font-family: 'DM Mono', monospace;
      font-size: 10px;
      color: var(--gold);
      font-weight: 500;
      letter-spacing: .1em;
      text-transform: uppercase;
      margin-bottom: 10px;
    }

    .gaap-card p {
      font-size: 15px;
      color: var(--text);
      line-height: 1.8;
    }

    .gaap-card b { color: var(--text); font-weight: 600; }

    /* ===== SIMULATOR ===== */
    .sim-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 16px;
    }

    .sim-header h3 {
      font-family: 'Playfair Display', serif;
      font-size: 20px;
      font-weight: 700;
    }

    .sim-controls { display: flex; gap: 8px; }

    .sim-btn {
      padding: 7px 14px;
      border-radius: 7px;
      background: var(--surface2);
      border: 1px solid var(--border);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: border-color .15s;
    }

    .sim-btn:hover { border-color: var(--border2); }
    .sim-btn.active { background: var(--green-dim); border-color: rgba(45,186,126,.3); color: var(--green); }

    .slider-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    @media (max-width: 700px) { .slider-grid { grid-template-columns: 1fr; } }

    .slider-card {
      padding: 16px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 11px;
    }

    .slider-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .slider-label {
      font-family: 'DM Mono', monospace;
      font-size: 12px;
      font-weight: 500;
      color: var(--muted);
      letter-spacing: .04em;
    }

    .slider-val {
      font-family: 'DM Mono', monospace;
      font-size: 14px;
      font-weight: 500;
      color: var(--green);
    }

    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 4px;
      background: var(--surface3);
      border-radius: 2px;
      outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px; height: 18px;
      border-radius: 50%;
      background: var(--green);
      cursor: pointer;
      box-shadow: 0 0 8px rgba(45,186,126,.4);
    }

    input[type="range"]::-moz-range-thumb {
      width: 18px; height: 18px;
      border-radius: 50%;
      background: var(--green);
      cursor: pointer;
      border: none;
    }

    .slider-mini {
      font-size: 12px;
      color: var(--muted2);
      line-height: 1.55;
      margin-top: 10px;
    }

    .slider-mini b { color: var(--text); }

    .eq-line-display {
      margin-top: 14px;
      padding: 14px 18px;
      border-radius: 10px;
      background: var(--surface2);
      border: 1px dashed rgba(45,186,126,.25);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .eq-line-display code {
      font-family: 'DM Mono', monospace;
      font-size: 13px;
      color: var(--text);
    }

    #eqStatus {
      font-family: 'DM Mono', monospace;
      font-size: 12px;
      font-weight: 500;
      white-space: nowrap;
    }

    /* ===== JOURNAL ENTRY TOOL ===== */
    .je-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 140px 120px;
      gap: 10px;
      margin-bottom: 12px;
    }

    @media (max-width: 800px) { .je-grid { grid-template-columns: 1fr 1fr; } }

    .je-select, .je-input {
      width: 100%;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 12px;
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      font-weight: 500;
      color: var(--text);
      outline: none;
      transition: border-color .15s;
    }

    .je-select:focus, .je-input:focus { border-color: var(--green); }
    .je-select option { background: #1c2333; }

    .je-row {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    .je-btn {
      padding: 9px 18px;
      border-radius: 8px;
      border: none;
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
    }

    .je-btn.add { background: var(--green); color: #071a10; }
    .je-btn.add:hover { opacity: .85; }
    .je-btn.undo { background: var(--surface2); border: 1px solid var(--border); color: var(--text); }
    .je-btn.reset { background: var(--red-dim); border: 1px solid rgba(240,96,96,.2); color: var(--red); }
    .je-btn.undo:hover, .je-btn.reset:hover { border-color: var(--border2); }

    .balances-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
      margin: 16px 0;
    }

    .bal-card {
      padding: 14px;
      border-radius: 10px;
      background: var(--surface2);
      border: 1px solid var(--border);
    }

    .bal-key {
      font-family: 'DM Mono', monospace;
      font-size: 10px;
      font-weight: 500;
      color: var(--muted);
      letter-spacing: .08em;
      text-transform: uppercase;
      margin-bottom: 6px;
    }

    .bal-val {
      font-family: 'DM Mono', monospace;
      font-size: 18px;
      font-weight: 500;
      color: var(--text);
    }

    .table-wrap {
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      background: var(--surface2);
      margin-top: 4px;
    }

    table { width: 100%; border-collapse: collapse; font-size: 13px; }

    thead { background: var(--surface3); border-bottom: 1px solid var(--border); }

    th {
      padding: 10px 12px;
      text-align: left;
      font-family: 'DM Mono', monospace;
      font-size: 10px;
      font-weight: 500;
      color: var(--muted);
      letter-spacing: .07em;
      text-transform: uppercase;
    }

    td {
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
      font-family: 'DM Mono', monospace;
      font-size: 12px;
      color: var(--text);
    }

    tbody tr:last-child td { border-bottom: none; }
    tbody tr:hover { background: rgba(255,255,255,.02); }

    .td-pos { color: var(--green); }
    .td-neg { color: var(--red); }

    .je-note {
      font-size: 12px;
      color: var(--muted2);
      line-height: 1.7;
      margin-top: 14px;
      padding: 14px;
      border-left: 2px solid var(--border);
    }

    .je-note b { color: var(--text); }

    /* ===== FINANCIAL STATEMENTS — numbered prose list ===== */
    .statements-list { display: grid; gap: 0; margin-top: 24px; }

    .stmt-row {
      display: grid;
      grid-template-columns: 40px 1fr;
      gap: 20px;
      align-items: baseline;
      padding: 16px 0;
      border-bottom: 1px solid var(--border);
    }
    .statements-list .stmt-row:last-child { border-bottom: none; }

    .stmt-num {
      font-family: 'Playfair Display', serif;
      font-size: 20px;
      font-weight: 900;
      color: var(--gold);
      opacity: .6;
    }

    .stmt-text b {
      display: block;
      font-size: 15px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 4px;
    }

    .stmt-text p {
      font-size: 15px;
      color: var(--text);
      line-height: 1.75;
    }

    /* ===== SUMMARY — clean prose ===== */
    .summary-list { display: grid; gap: 20px; margin-top: 24px; }

    .summary-item {
      display: grid;
      grid-template-columns: 32px 1fr;
      gap: 16px;
      align-items: baseline;
    }

    .summary-num {
      font-family: 'DM Mono', monospace;
      font-size: 11px;
      font-weight: 500;
      color: var(--green);
      opacity: .7;
      padding-top: 3px;
    }

    .summary-text {
      font-size: 15px;
      line-height: 1.8;
      color: var(--text);
    }

    .summary-text b { color: var(--text); font-weight: 600; }

    /* ===== RECAP QUIZ ===== */
    .recap-quiz {
      border-top: 1px solid var(--border);
      padding: 48px 40px;
      background: rgba(212,168,67,.025);
    }

    .recap-header {
      display: flex;
      align-items: baseline;
      gap: 14px;
      margin-bottom: 8px;
    }

    .recap-header h2 {
      font-family: 'Playfair Display', serif;
      font-size: 26px;
      font-weight: 900;
      letter-spacing: -.01em;
    }

    .recap-intro {
      color: var(--muted);
      font-size: 15px;
      line-height: 1.75;
      margin-bottom: 36px;
      max-width: 680px;
    }

    .rq-item {
      margin-bottom: 32px;
    }

    .rq-item:last-child { margin-bottom: 0; }

    .rq-q {
      font-size: 15px;
      font-weight: 600;
      color: var(--text);
      line-height: 1.55;
      margin-bottom: 12px;
      display: flex;
      gap: 10px;
    }

    .rq-num {
      font-family: 'DM Mono', monospace;
      font-size: 11px;
      color: var(--gold);
      padding-top: 3px;
      flex-shrink: 0;
    }

    .rq-options { display: grid; gap: 8px; margin-left: 28px; }

    .rq-option {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 11px 14px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--surface);
      cursor: pointer;
      transition: border-color .15s, background .15s;
      font-size: 14px;
      color: var(--muted);
      line-height: 1.5;
      user-select: none;
    }

    .rq-option:hover { border-color: rgba(212,168,67,.3); color: var(--text); }
    .rq-option.selected { border-color: rgba(212,168,67,.4); background: rgba(212,168,67,.06); color: var(--text); }
    .rq-option.correct { border-color: rgba(45,186,126,.4); background: rgba(45,186,126,.08); color: var(--green); }
    .rq-option.wrong { border-color: rgba(240,96,96,.4); background: rgba(240,96,96,.07); color: var(--red); }

    .rq-letter {
      font-family: 'DM Mono', monospace;
      font-size: 11px;
      font-weight: 500;
      color: var(--muted2);
      flex-shrink: 0;
      padding-top: 1px;
    }

    .rq-feedback {
      margin-left: 28px;
      margin-top: 8px;
      font-size: 13px;
      line-height: 1.6;
      color: var(--muted2);
      display: none;
    }

    .rq-feedback.show { display: block; }
    .rq-feedback.good { color: var(--green); }
    .rq-feedback.bad { color: var(--muted); }

    .recap-score {
      display: none;
      margin-top: 40px;
      padding: 28px 32px;
      border-radius: 14px;
      background: rgba(45,186,126,.06);
      border: 1px solid rgba(45,186,126,.2);
      text-align: center;
    }

    .recap-score.show { display: block; }

    .recap-score-num {
      font-family: 'Playfair Display', serif;
      font-size: 52px;
      font-weight: 900;
      color: var(--green);
      line-height: 1;
    }

    .recap-score-label {
      font-size: 14px;
      color: var(--muted);
      margin-top: 8px;
    }

    .recap-submit {
      margin-top: 32px;
      padding: 13px 32px;
      border-radius: 10px;
      background: rgba(212,168,67,.15);
      border: 1px solid rgba(212,168,67,.3);
      color: var(--gold);
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: background .15s;
    }

    .recap-submit:hover { background: rgba(212,168,67,.25); }
    .recap-submit:disabled { opacity: .4; cursor: default; }

    /* ===== MASTERY CHECK MODAL ===== */
    .mastery-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.75);
      backdrop-filter: blur(10px);
      z-index: 9200;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity .3s;
    }
    .mastery-overlay.open {
      opacity: 1;
      pointer-events: all;
    }

    .mastery-modal {
      background: var(--surface);
      border: 1px solid var(--border2);
      border-radius: 22px;
      width: calc(100% - 48px);
      max-width: 620px;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 40px 100px rgba(0,0,0,.6);
      transform: translateY(20px) scale(.97);
      transition: transform .3s;
      overflow: hidden;
    }
    .mastery-overlay.open .mastery-modal {
      transform: translateY(0) scale(1);
    }

    .mastery-header {
      padding: 28px 32px 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 16px;
      flex-shrink: 0;
    }

    .mastery-header-left { flex: 1; }

    .mastery-eyebrow {
      font-family: 'DM Mono', monospace;
      font-size: 10px;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: var(--green);
      margin-bottom: 6px;
    }

    .mastery-header h3 {
      font-family: 'Playfair Display', serif;
      font-size: 22px;
      font-weight: 900;
      margin-bottom: 4px;
    }

    .mastery-header p {
      font-size: 13px;
      color: var(--muted);
    }

    .mastery-progress-track {
      height: 3px;
      background: var(--surface3);
      border-radius: 2px;
      margin-top: 16px;
      overflow: hidden;
    }

    .mastery-progress-fill {
      height: 100%;
      background: var(--green);
      border-radius: 2px;
      transition: width .4s ease;
    }

    .mastery-close-btn {
      width: 32px; height: 32px;
      border-radius: 8px;
      background: var(--surface2);
      border: 1px solid var(--border);
      color: var(--muted);
      font-size: 18px;
      cursor: pointer;
      display: grid;
      place-items: center;
      flex-shrink: 0;
      transition: background .15s, color .15s;
      line-height: 1;
    }
    .mastery-close-btn:hover { background: var(--surface3); color: var(--text); }

    .mastery-body {
      flex: 1;
      overflow-y: auto;
      padding: 32px;
    }

    /* Question screen */
    .mq-screen { display: none; }
    .mq-screen.active { display: block; }

    .mq-counter {
      font-family: 'DM Mono', monospace;
      font-size: 11px;
      color: var(--muted2);
      margin-bottom: 16px;
    }

    .mq-question {
      font-size: 18px;
      font-weight: 600;
      line-height: 1.55;
      color: var(--text);
      margin-bottom: 24px;
    }

    .mq-options {
      display: grid;
      gap: 10px;
      margin-bottom: 20px;
    }

    .mq-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--surface2);
      cursor: pointer;
      transition: border-color .15s, background .15s;
      font-size: 15px;
      color: var(--text);
      user-select: none;
    }
    .mq-option:hover:not(.locked) { border-color: rgba(45,186,126,.4); background: var(--green-dim); }
    .mq-option.selected { border-color: rgba(45,186,126,.5); background: rgba(45,186,126,.08); }
    .mq-option.correct  { border-color: rgba(45,186,126,.7); background: rgba(45,186,126,.12); color: var(--green); }
    .mq-option.wrong    { border-color: rgba(240,96,96,.5);  background: rgba(240,96,96,.08);  color: var(--red); }
    .mq-option.reveal-correct { border-color: rgba(45,186,126,.4); background: rgba(45,186,126,.06); }

    .mq-letter {
      font-family: 'DM Mono', monospace;
      font-size: 11px;
      font-weight: 500;
      width: 20px;
      height: 20px;
      border-radius: 5px;
      background: var(--surface3);
      display: grid;
      place-items: center;
      flex-shrink: 0;
      color: var(--muted2);
      transition: background .15s, color .15s;
    }
    .mq-option.correct  .mq-letter { background: rgba(45,186,126,.25); color: var(--green); }
    .mq-option.wrong    .mq-letter { background: rgba(240,96,96,.2);   color: var(--red); }

    .mq-explanation {
      font-size: 14px;
      color: var(--muted);
      line-height: 1.7;
      padding: 14px 16px;
      border-radius: 10px;
      background: var(--surface2);
      border-left: 3px solid var(--border);
      margin-bottom: 20px;
      display: none;
    }
    .mq-explanation.show { display: block; }
    .mq-explanation.good { border-left-color: var(--green); }
    .mq-explanation.bad  { border-left-color: var(--red); }

    .mq-next-btn {
      width: 100%;
      padding: 13px;
      border-radius: 10px;
      background: var(--green);
      color: #071a10;
      border: none;
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: opacity .15s;
      display: none;
    }
    .mq-next-btn.show { display: block; }
    .mq-next-btn:hover { opacity: .85; }

    /* Result screen */
    .mastery-result {
      text-align: center;
      padding: 8px 0;
    }

    .mastery-result-ring {
      width: 100px; height: 100px;
      border-radius: 50%;
      margin: 0 auto 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Playfair Display', serif;
      font-size: 32px;
      font-weight: 900;
    }
    .mastery-result-ring.pass {
      background: rgba(45,186,126,.12);
      border: 3px solid rgba(45,186,126,.4);
      color: var(--green);
    }
    .mastery-result-ring.fail {
      background: rgba(240,96,96,.08);
      border: 3px solid rgba(240,96,96,.3);
      color: var(--red);
    }

    .mastery-result h3 {
      font-family: 'Playfair Display', serif;
      font-size: 24px;
      font-weight: 900;
      margin-bottom: 10px;
    }

    .mastery-result p {
      font-size: 15px;
      color: var(--muted);
      line-height: 1.7;
      max-width: 400px;
      margin: 0 auto 28px;
    }

    .mastery-result-btns {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .mq-retry-btn {
      padding: 12px 24px;
      border-radius: 10px;
      background: var(--surface2);
      border: 1px solid var(--border);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: border-color .15s;
    }
    .mq-retry-btn:hover { border-color: var(--border2); }

    .mq-done-btn {
      padding: 12px 24px;
      border-radius: 10px;
      background: var(--green);
      border: none;
      color: #071a10;
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: opacity .15s;
    }
    .mq-done-btn:hover { opacity: .85; }

    /* Review sections on results screen */
    .review-sections {
      margin: 0 auto 28px;
      max-width: 420px;
      text-align: left;
    }

    .review-label {
      font-family: 'DM Mono', monospace;
      font-size: 10px;
      letter-spacing: .1em;
      text-transform: uppercase;
      color: var(--gold);
      margin-bottom: 10px;
      text-align: center;
    }

    .review-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 11px 14px;
      border-radius: 9px;
      border: 1px solid rgba(212,168,67,.2);
      background: rgba(212,168,67,.04);
      color: var(--text);
      font-size: 14px;
      cursor: pointer;
      margin-bottom: 8px;
      transition: background .15s, border-color .15s;
    }

    .review-item:hover {
      background: rgba(212,168,67,.1);
      border-color: rgba(212,168,67,.4);
      color: var(--gold);
    }

    .review-item svg { color: var(--gold); flex-shrink: 0; }

    /* ===== OVERVIEW SECTION — distinct from content sections ===== */
    #obj0 {
      background: linear-gradient(135deg, rgba(45,186,126,.06) 0%, rgba(212,168,67,.04) 100%);
      border-top: none;
      border-bottom: 2px solid rgba(45,186,126,.15);
      padding: 40px 40px 36px;
    }

    #obj0 .section-title-row .obj-badge {
      color: var(--green);
    }

    #obj0 .section-title-row h2 {
      font-size: 22px;
    }

    #obj0 .section-intro {
      font-size: 14px;
      margin-bottom: 20px;
    }

    /* ===== NEXT CHAPTER MODAL ===== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.65);
      backdrop-filter: blur(6px);
      z-index: 9000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity .25s;
    }

    .modal-overlay.open {
      opacity: 1;
      pointer-events: all;
    }

    .modal {
      background: var(--surface);
      border: 1px solid var(--border2);
      border-radius: 20px;
      padding: 36px 40px 32px;
      max-width: 480px;
      width: calc(100% - 48px);
      box-shadow: 0 32px 80px rgba(0,0,0,.5);
      transform: translateY(12px);
      transition: transform .25s;
    }

    .modal-overlay.open .modal {
      transform: translateY(0);
    }

    .modal-eyebrow {
      font-family: 'DM Mono', monospace;
      font-size: 10px;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: var(--green);
      margin-bottom: 10px;
    }

    .modal h3 {
      font-family: 'Playfair Display', serif;
      font-size: 24px;
      font-weight: 900;
      margin-bottom: 8px;
    }

    .modal-sub {
      font-size: 14px;
      color: var(--muted);
      line-height: 1.65;
      margin-bottom: 28px;
    }

    .modal-chapters {
      display: grid;
      gap: 8px;
      max-height: 340px;
      overflow-y: auto;
      margin-bottom: 24px;
      padding-right: 4px;
    }

    .modal-ch {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--surface2);
      cursor: pointer;
      transition: border-color .15s, background .15s;
    }

    .modal-ch:hover { border-color: var(--green-bright); background: var(--green-dim); }

    .modal-ch.current { opacity: .4; cursor: default; }
    .modal-ch.current:hover { border-color: var(--border); background: var(--surface2); }

    .modal-ch-num {
      font-family: 'DM Mono', monospace;
      font-size: 11px;
      color: var(--muted2);
      width: 28px;
      flex-shrink: 0;
    }

    .modal-ch-title {
      flex: 1;
      font-size: 14px;
      font-weight: 500;
      color: var(--text);
    }

    .modal-ch-badge {
      font-family: 'DM Mono', monospace;
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 4px;
      flex-shrink: 0;
    }

    .modal-ch-badge.live { background: var(--green-dim); color: var(--green); border: 1px solid rgba(45,186,126,.25); }
    .modal-ch-badge.soon { background: var(--surface3); color: var(--muted2); }

    .modal-close {
      width: 100%;
      padding: 11px;
      border-radius: 9px;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      cursor: pointer;
      transition: border-color .15s, color .15s;
    }

    .modal-close:hover { border-color: var(--border2); color: var(--text); }
    .next-chapter-bar {
      border-top: 1px solid var(--border);
      padding: 32px 40px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
    }

    .next-chapter-info {
      font-size: 13px;
      color: var(--muted2);
    }

    .next-chapter-info strong {
      display: block;
      font-family: 'DM Mono', monospace;
      font-size: 10px;
      letter-spacing: .1em;
      text-transform: uppercase;
      color: var(--muted2);
      margin-bottom: 4px;
    }

    .btn-next-chapter {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 14px 28px;
      background: var(--green);
      color: #071a10;
      border: none;
      border-radius: 10px;
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      text-decoration: none;
      transition: opacity .15s, transform .15s;
      box-shadow: 0 4px 20px rgba(45,186,126,.25);
    }

    .btn-next-chapter:hover { opacity: .88; transform: translateX(3px); }

    @media (max-width: 600px) {
      .next-chapter-bar { flex-direction: column; align-items: flex-start; }
      .recap-quiz { padding: 32px 20px; }
    }

    /* ===== COMING SOON ===== */
    .coming-section {
      border-top: 1px solid var(--border);
      padding: 40px;
      text-align: center;
    }

    .coming-section h2 {
      font-family: 'Playfair Display', serif;
      font-size: 22px;
      font-weight: 700;
      color: var(--muted);
      margin-bottom: 10px;
    }

    .coming-section p {
      font-size: 14px;
      color: var(--muted2);
      max-width: 540px;
      margin: 0 auto;
      line-height: 1.7;
    }

    /* ===== FOOTER ===== */
    .ch-footer {
      border-top: 1px solid var(--border);
      padding: 20px 40px;
      font-family: 'DM Mono', monospace;
      font-size: 11px;
      color: var(--muted2);
      text-align: center;
      letter-spacing: .04em;
    }

    /* ===== TOAST ===== */
    #toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--surface2);
      border: 1px solid var(--green-bright);
      color: var(--green);
      font-family: 'DM Mono', monospace;
      font-size: 12px;
      font-weight: 500;
      padding: 10px 18px;
      border-radius: 8px;
      opacity: 0;
      transition: opacity .25s;
      pointer-events: none;
      z-index: 9999;
    }

    #toast.show { opacity: 1; }

    @media (max-width: 920px) {
      .je-grid { grid-template-columns: 1fr 1fr; }
    }

    @media (max-width: 600px) {
      .ch-hero { padding: 32px 20px; }
      .section { padding: 28px 20px; }
      .balances-row { grid-template-columns: 1fr; }
    }

    /* ============================================================
       ANIMATIONS
    ============================================================ */

    /* --- 1. Equation shake (unbalanced) --- */
    @keyframes shake {
      0%,100% { transform: translateX(0); }
      12%      { transform: translateX(-7px); }
      25%      { transform: translateX( 7px); }
      37%      { transform: translateX(-5px); }
      50%      { transform: translateX( 5px); }
      62%      { transform: translateX(-3px); }
      75%      { transform: translateX( 3px); }
      88%      { transform: translateX(-1px); }
    }
    .shake { animation: shake 0.52s cubic-bezier(.36,.07,.19,.97) both; }

    /* --- 2. Slider glow pulse while dragging --- */
    @keyframes thumbPulse {
      0%,100% { box-shadow: 0 0 8px rgba(45,186,126,.45); }
      50%      { box-shadow: 0 0 22px rgba(45,186,126,.9), 0 0 40px rgba(45,186,126,.35); }
    }
    input[type="range"].dragging::-webkit-slider-thumb {
      animation: thumbPulse 0.75s ease-in-out infinite;
    }
    input[type="range"].dragging::-moz-range-thumb {
      animation: thumbPulse 0.75s ease-in-out infinite;
    }
    /* Track highlight while dragging */
    input[type="range"].dragging {
      background: linear-gradient(90deg, rgba(45,186,126,.3) var(--pct,0%), rgba(255,255,255,.06) var(--pct,0%));
    }

    /* --- 3. Journal row flash --- */
    @keyframes flashGreen {
      0%   { background: rgba(45,186,126,.28); }
      100% { background: transparent; }
    }
    @keyframes flashRed {
      0%   { background: rgba(240,96,96,.22); }
      100% { background: transparent; }
    }
    tr.flash-green { animation: flashGreen 0.9s ease forwards; }
    tr.flash-red   { animation: flashRed   0.55s ease forwards; }

    /* --- 4. Confetti particles --- */
    .confetti-dot {
      position: fixed;
      width: 7px; height: 7px;
      border-radius: 50%;
      pointer-events: none;
      z-index: 9998;
      will-change: transform, opacity;
    }

    /* --- 5. Floating hero particles (canvas) --- */
    #heroParticleCanvas {
      position: absolute;
      inset: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    /* --- 6. Falling money canvas --- */
    #moneyCanvas {
      position: absolute;
      inset: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    /* --- 7. Cursor trail (canvas) --- */
    #cursorCanvas {
      position: fixed;
      inset: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 9990;
    }

    /* Make ch-hero a stacking context so canvas stays behind content */
    .ch-hero { isolation: isolate; }
    .ch-hero-inner { position: relative; z-index: 1; }

    /* ===== AUTH STYLES ===== */
    .auth-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--surface2);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: border-color .15s, background .15s;
      white-space: nowrap;
    }
    .auth-btn:hover { border-color: var(--border2); background: var(--surface3); }
    .auth-btn svg { flex-shrink: 0; }

    .user-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 5px 12px 5px 5px;
      border-radius: 9px;
      border: 1px solid var(--border);
      background: var(--surface2);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: border-color .15s, background .15s;
    }
    .user-btn:hover { border-color: var(--border2); background: var(--surface3); }

    .user-avatar {
      width: 28px; height: 28px;
      border-radius: 50%;
      object-fit: cover;
      display: block;
    }

    .user-avatar-placeholder {
      width: 28px; height: 28px;
      border-radius: 50%;
      background: var(--green-dim);
      border: 1px solid rgba(45,186,126,.3);
      display: grid;
      place-items: center;
      font-size: 12px;
      font-weight: 700;
      color: var(--green);
      flex-shrink: 0;
    }

    /* Auth modal */
    .auth-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.7);
      backdrop-filter: blur(8px);
      z-index: 9100;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity .25s;
    }
    .auth-modal-overlay.open {
      opacity: 1;
      pointer-events: all;
    }
    .auth-modal {
      background: var(--surface);
      border: 1px solid var(--border2);
      border-radius: 20px;
      padding: 40px;
      max-width: 400px;
      width: calc(100% - 48px);
      box-shadow: 0 40px 100px rgba(0,0,0,.6);
      transform: translateY(16px) scale(.98);
      transition: transform .25s;
      text-align: center;
    }
    .auth-modal-overlay.open .auth-modal { transform: translateY(0) scale(1); }

    .auth-logo-ring {
      width: 64px; height: 64px;
      border-radius: 50%;
      background: var(--green-dim);
      border: 2px solid rgba(45,186,126,.3);
      display: grid;
      place-items: center;
      margin: 0 auto 20px;
    }

    .auth-modal h3 {
      font-family: 'Playfair Display', serif;
      font-size: 24px;
      font-weight: 900;
      margin-bottom: 8px;
    }

    .auth-modal p {
      font-size: 14px;
      color: var(--muted);
      line-height: 1.65;
      margin-bottom: 28px;
    }

    .google-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      width: 100%;
      padding: 13px 20px;
      border-radius: 10px;
      border: 1px solid var(--border2);
      background: #fff;
      color: #1f1f1f;
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: box-shadow .15s, transform .15s;
    }
    .google-btn:hover { box-shadow: 0 4px 20px rgba(0,0,0,.3); transform: translateY(-1px); }
    .google-btn:active { transform: translateY(0); }

    .auth-divider {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 20px 0;
      color: var(--muted2);
      font-size: 12px;
    }
    .auth-divider::before, .auth-divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    .auth-skip {
      width: 100%;
      padding: 11px;
      border-radius: 9px;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      cursor: pointer;
      transition: border-color .15s, color .15s;
    }
    .auth-skip:hover { border-color: var(--border2); color: var(--text); }

    /* Profile dropdown */
    .profile-dropdown {
      position: absolute;
      top: calc(100% + 10px);
      right: 0;
      background: var(--surface);
      border: 1px solid var(--border2);
      border-radius: 14px;
      padding: 8px;
      min-width: 220px;
      box-shadow: 0 20px 60px rgba(0,0,0,.5);
      z-index: 500;
      opacity: 0;
      pointer-events: none;
      transform: translateY(-8px);
      transition: opacity .18s, transform .18s;
    }
    .profile-dropdown.open {
      opacity: 1;
      pointer-events: all;
      transform: translateY(0);
    }

    .profile-header {
      padding: 12px 12px 10px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 6px;
    }
    .profile-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
    }
    .profile-email {
      font-size: 12px;
      color: var(--muted2);
      margin-top: 2px;
    }

    .profile-progress {
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 6px;
    }
    .profile-progress-label {
      font-family: 'DM Mono', monospace;
      font-size: 9px;
      letter-spacing: .1em;
      text-transform: uppercase;
      color: var(--muted2);
      margin-bottom: 8px;
    }
    .progress-bar-wrap {
      height: 5px;
      background: var(--surface3);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 4px;
    }
    .progress-bar-fill {
      height: 100%;
      background: var(--green);
      border-radius: 3px;
      transition: width .4s ease;
    }
    .progress-pct {
      font-family: 'DM Mono', monospace;
      font-size: 11px;
      color: var(--green);
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 9px 12px;
      border-radius: 8px;
      font-size: 13px;
      color: var(--muted);
      cursor: pointer;
      transition: background .12s, color .12s;
      border: none;
      background: transparent;
      width: 100%;
      text-align: left;
      font-family: 'DM Sans', sans-serif;
    }
    .dropdown-item:hover { background: var(--surface2); color: var(--text); }
    .dropdown-item.danger:hover { background: var(--red-dim); color: var(--red); }

    .nav-auth-wrap { position: relative; }

    /* Progress ring on checklist items for signed-in users */
    .ch1-progress-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 6px;
      background: var(--green-dim);
      border: 1px solid rgba(45,186,126,.2);
      font-family: 'DM Mono', monospace;
      font-size: 11px;
      color: var(--green);
      margin-left: 12px;
    }

    /* Firebase config notice banner */
    .firebase-notice {
      background: rgba(212,168,67,.08);
      border: 1px solid rgba(212,168,67,.25);
      border-left: 3px solid var(--gold);
      border-radius: 10px;
      padding: 14px 18px;
      margin: 16px 40px;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.6;
      display: none;
    }
    .firebase-notice.show { display: block; }
    .firebase-notice b { color: var(--gold); }
    .firebase-notice code {
      font-family: 'DM Mono', monospace;
      font-size: 12px;
      background: rgba(212,168,67,.1);
      padding: 2px 6px;
      border-radius: 4px;
      color: var(--gold);
    }
  </style>
</head>
<body>

  <!-- Firebase SDKs (modular v10) -->
  <script type="module">
    // ============================================================
    // FIREBASE SETUP
    // ============================================================
    // 1. Go to https://console.firebase.google.com
    // 2. Create a project → Add Web App → copy config below
    // 3. Enable Google Sign-In: Authentication → Sign-in method → Google
    // 4. Enable Firestore: Firestore Database → Create database (start in test mode)
    // 5. Add your GitHub Pages domain to Auth → Settings → Authorized domains
    //    e.g. yourusername.github.io
    // ============================================================

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged }
      from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, serverTimestamp }
      from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ─── REPLACE THIS BLOCK WITH YOUR FIREBASE CONFIG ──────────
    const firebaseConfig = {
      apiKey:            "AIzaSyAPWmZttt-N29lZceK2dJEVqfU80YbqBXY",
      authDomain:        "accounting-by-noah.firebaseapp.com",
      projectId:         "accounting-by-noah",
      storageBucket:     "accounting-by-noah.firebasestorage.app",
      messagingSenderId: "855215961646",
      appId:             "1:855215961646:web:9eda0eb4fae7b8710a51bf"
    };
    // ────────────────────────────────────────────────────────────

    // Detect unconfigured state
    const isConfigured = firebaseConfig.apiKey !== "REPLACE_WITH_YOUR_API_KEY";

    if (!isConfigured) {
      document.getElementById('firebaseNotice').classList.add('show');
    }

    let app, auth, db, currentUser = null;

    if (isConfigured) {
      app  = initializeApp(firebaseConfig);
      auth = getAuth(app);
      db   = getFirestore(app);

      // ── Auth state listener ──────────────────────────────────
      onAuthStateChanged(auth, async user => {
        currentUser = user;
        if (user) {
          renderUserNav(user);
          await loadProgress(user.uid);
        } else {
          renderSignInNav();
        }
      });
    }

    // ── Sign in with Google ──────────────────────────────────
    window.signInWithGoogle = async function() {
      if (!isConfigured) return;
      try {
        const provider = new GoogleAuthProvider();
        await signInWithPopup(auth, provider);
        closeAuthModal();
      } catch (e) {
        console.error("Sign-in error:", e);
        showToast("Sign-in failed — check console.");
      }
    };

    // ── Sign out ─────────────────────────────────────────────
    window.signOutUser = async function() {
      if (!isConfigured) return;
      await signOut(auth);
      closeProfileDropdown();
      showToast("Signed out.");
    };

    // ── Save progress to Firestore ───────────────────────────
    window.saveProgress = async function(data) {
      if (!currentUser || !isConfigured) return;
      const ref = doc(db, "progress", currentUser.uid);
      await setDoc(ref, { ...data, updatedAt: serverTimestamp() }, { merge: true });
    };

    // ── Load progress from Firestore ─────────────────────────
    async function loadProgress(uid) {
      if (!isConfigured) return;
      try {
        const ref  = doc(db, "progress", uid);
        const snap = await getDoc(ref);
        if (!snap.exists()) return;
        const data = snap.data();

        // Restore checklist
        if (data.checklist) {
          const labels = document.querySelectorAll('#checklist label');
          labels.forEach((label, i) => {
            const cb = label.querySelector('input[type=checkbox]');
            if (cb && data.checklist[i]) {
              cb.checked = true;
              label.style.color = 'var(--green)';
              label.style.textDecoration = 'line-through';
            }
          });
        }

        // Restore recap score display
        if (data.recapScore !== undefined) {
          const scoreEl = document.getElementById('recapScore');
          const scoreNum = document.getElementById('recapScoreNum');
          const scoreLabel = document.getElementById('recapScoreLabel');
          const pct = data.recapScore / 10;
          scoreNum.textContent = `${data.recapScore}/10`;
          if (pct >= 0.9) scoreLabel.textContent = "Excellent — you've mastered Chapter 1!";
          else if (pct >= 0.7) scoreLabel.textContent = 'Good work — review the questions you missed.';
          else scoreLabel.textContent = 'Keep studying — re-read the sections you missed.';
          scoreEl.classList.add('show');
          document.getElementById('recapSubmit').disabled = true;
        }

        updateProgressBar();
        showToast("Progress loaded ✓");
      } catch (e) {
        console.error("Load progress error:", e);
      }
    }

    // ── UI helpers ───────────────────────────────────────────
    function renderSignInNav() {
      const wrap = document.getElementById('navAuthWrap');
      wrap.innerHTML = `
        <button class="nav-btn green" onclick="openAuthModal()" style="display:flex;align-items:center;gap:7px;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
          Log In
        </button>`;
    }

    function renderUserNav(user) {
      const wrap = document.getElementById('navAuthWrap');
      const initial = (user.displayName || user.email || '?')[0].toUpperCase();
      const avatarHtml = user.photoURL
        ? `<img src="${user.photoURL}" class="user-avatar" referrerpolicy="no-referrer" alt=""/>`
        : `<div class="user-avatar-placeholder">${initial}</div>`;
      const name = (user.displayName || user.email || '').split(' ')[0];
      wrap.innerHTML = `
        <div class="nav-auth-wrap">
          <button class="user-btn" onclick="toggleProfileDropdown()">
            ${avatarHtml}
            <span>${name}</span>
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
          </button>
          <div class="profile-dropdown" id="profileDropdown">
            <div class="profile-header">
              <div class="profile-name">${user.displayName || 'Student'}</div>
              <div class="profile-email">${user.email}</div>
            </div>
            <div class="profile-progress">
              <div class="profile-progress-label">Chapter 1 Progress</div>
              <div class="progress-bar-wrap"><div class="progress-bar-fill" id="progressBarFill" style="width:0%"></div></div>
              <div class="progress-pct" id="progressPct">0%</div>
            </div>
            <button class="dropdown-item" onclick="saveAllProgress(); closeProfileDropdown();">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
              Save Progress
            </button>
            <button class="dropdown-item danger" onclick="signOutUser()">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
              Sign Out
            </button>
          </div>
        </div>`;
      updateProgressBar();
    }

    window.updateProgressBar = function() {
      const fill = document.getElementById('progressBarFill');
      const pctEl = document.getElementById('progressPct');
      if (!fill) return;
      const checkboxes = document.querySelectorAll('#checklist input[type=checkbox]');
      const checked = [...checkboxes].filter(c => c.checked).length;
      const total = checkboxes.length || 1;
      const pct = Math.round((checked / total) * 100);
      fill.style.width = pct + '%';
      if (pctEl) pctEl.textContent = pct + '%';
    };

    // ── Save all current progress ────────────────────────────
    window.saveAllProgress = async function() {
      const checkboxes = document.querySelectorAll('#checklist input[type=checkbox]');
      const checklistState = [...checkboxes].map(c => c.checked);
      const scoreEl = document.getElementById('recapScoreNum');
      let recapScore = undefined;
      if (scoreEl && scoreEl.textContent && scoreEl.textContent !== '—') {
        recapScore = parseInt(scoreEl.textContent);
      }
      const data = { checklist: checklistState };
      if (recapScore !== undefined) data.recapScore = recapScore;
      await saveProgress(data);
      updateProgressBar();
      showToast("Progress saved ✓");
    };

    if (!isConfigured) {
      // Show sign-in UI anyway so it's clear what to set up
      window.addEventListener('DOMContentLoaded', () => {
        const wrap = document.getElementById('navAuthWrap');
        if (wrap) wrap.innerHTML = `<button class="nav-btn green" onclick="openAuthModal()" style="display:flex;align-items:center;gap:7px;opacity:.6" title="Firebase not configured yet"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>Log In</button>`;
      });
    }
  </script>

  <!-- NAV -->
  <nav>
    <a href="index.html" class="nav-brand">
      <div class="nav-logo"><img src="logo-accounting-by-noah.png" alt="Accounting By Noah logo"></div>
      <div class="nav-brand-text">
        Accounting By Noah
        <small>Learning Portal</small>
      </div>
    </a>
    <div class="nav-spacer"></div>
    <div class="nav-pill">
      <span style="font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;letter-spacing:.06em;flex-shrink:0;">CH</span>
      <select id="chapterSelect" onchange="selectChapterFromDropdown()">
        <option value="1" selected>01 — Intro to Accounting & Business</option>
        <option value="2">02 — Coming Soon</option>
        <option value="3">03 — Coming Soon</option>
        <option value="4">04 — Coming Soon</option>
        <option value="5">05 — Coming Soon</option>
        <option value="6">06 — Coming Soon</option>
        <option value="7">07 — Coming Soon</option>
        <option value="8">08 — Coming Soon</option>
        <option value="9">09 — Coming Soon</option>
        <option value="10">10 — Coming Soon</option>
        <option value="11">11 — Coming Soon</option>
        <option value="12">12 — Coming Soon</option>
        <option value="13">13 — Coming Soon</option>
        <option value="14">14 — Coming Soon</option>
      </select>
    </div>
    <button class="nav-btn" onclick="toggleStudyMode()">Study Mode</button>
    <button class="nav-btn green" onclick="openMasteryModal()">Mastery Check</button>
    <div id="navAuthWrap">
      <button class="nav-btn green" onclick="openAuthModal()" style="display:flex;align-items:center;gap:7px;">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        Log In
      </button>
    </div>
  </nav>

  <!-- Firebase config notice -->
  <div class="firebase-notice" id="firebaseNotice">
    <b>Firebase not configured yet.</b> Sign-in will work once you add your config.
    Open this file, find the <code>firebaseConfig</code> block near the top, and replace the placeholder values with your project credentials.
    See <b>SETUP.md</b> for the full walkthrough.
  </div>

  <!-- AUTH MODAL -->
  <div class="auth-modal-overlay" id="authModal" onclick="if(event.target===this)closeAuthModal()">
    <div class="auth-modal">
      <div class="auth-logo-ring">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#2dba7e" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      </div>
      <h3>Welcome back</h3>
      <p>Sign in with Google to save your quiz scores, checklist progress, and pick up right where you left off — on any device.</p>
      <button class="google-btn" onclick="signInWithGoogle()">
        <svg width="20" height="20" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.08 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.18 1.48-4.97 2.31-8.16 2.31-6.26 0-11.57-3.59-13.46-8.66l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/><path fill="none" d="M0 0h48v48H0z"/></svg>
        Continue with Google
      </button>
      <div class="auth-divider">or</div>
      <button class="auth-skip" onclick="closeAuthModal()">Continue without signing in</button>
    </div>
  </div>

  <div id="toast">Copied</div>

  <!-- Cursor trail canvas (full page) -->
  <canvas id="cursorCanvas"></canvas>

  <!-- MASTERY CHECK MODAL -->
  <div class="mastery-overlay" id="masteryOverlay" onclick="if(event.target===this)closeMasteryModal()">
    <div class="mastery-modal">
      <div class="mastery-header">
        <div class="mastery-header-left">
          <div class="mastery-eyebrow">Chapter 1 — Mastery Check</div>
          <h3>Test Your Knowledge</h3>
          <p id="masterySubtitle">15 questions across all topics. No time pressure.</p>
          <div class="mastery-progress-track">
            <div class="mastery-progress-fill" id="masteryProgressFill" style="width:0%"></div>
          </div>
        </div>
        <button class="mastery-close-btn" onclick="closeMasteryModal()">×</button>
      </div>
      <div class="mastery-body" id="masteryBody">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>

  <!-- CHAPTER SELECT MODAL -->
  <div class="modal-overlay" id="chapterModal" onclick="if(event.target===this) closeChapterModal()">
    <div class="modal">
      <div class="modal-eyebrow">Accounting By Noah</div>
      <h3>Jump to a Chapter</h3>
      <p class="modal-sub">Chapter 1 is fully built. Chapters 2–14 are scaffolded and ready for content.</p>
      <div class="modal-chapters" id="modalChapterList"></div>
      <button class="modal-close" onclick="closeChapterModal()">Close</button>
    </div>
  </div>

  <!-- WRAP -->
  <div class="wrap">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-head">
        <div class="sidebar-label">Curriculum</div>
        <div class="sidebar-title">14 Chapters</div>
        <div class="sidebar-sub">Chapter 1 is live. The rest are scaffolded and ready to fill in.</div>
      </div>
      <div class="ch-list" id="chapterList"></div>
    </aside>

    <!-- CONTENT -->
    <main class="content">

      <!-- CHAPTER HERO -->
      <div class="ch-hero" id="hero">
        <canvas id="heroParticleCanvas"></canvas>
        <canvas id="moneyCanvas"></canvas>
        <div class="ch-hero-inner">
          <div class="ch-tag">Chapter 01 — Active</div>
          <h1 id="heroTitle">Introduction to Accounting & Business</h1>
          <p id="heroDesc">19 sections covering everything from business fundamentals and ethics, through GAAP, the accounting equation, transaction analysis, and all four financial statements — plus a full glossary and study checklist.</p>
          <div class="ch-hero-actions">
            <a href="#obj1" class="jump-btn primary">Start Lesson →</a>
            <a href="#obj8" class="jump-btn">Glossary & Checklist</a>
          </div>
        </div>
      </div>

      <!-- ===== OVERVIEW ===== -->
      <section class="section" id="obj0">
        <div class="section-title-row">
          <span class="obj-badge">Overview</span>
          <h2>What's in this chapter</h2>
        </div>
        <p class="section-intro">This chapter builds your accounting foundation from the ground up — starting with what a business is and why accounting exists, moving through ethics and GAAP, through the accounting equation and transactions, all the way to the four financial statements and how they connect. Click any row to jump straight to that section.</p>
        <div class="terms">
          <div class="term toc-link" onclick="jumpTo('obj1')"><span class="term-tag">01–02</span><div class="term-body"><b>Business & Users</b> — What a business is, what profit means, and who uses accounting information.</div><span class="toc-arrow">↓</span></div>
          <div class="term toc-link" onclick="jumpTo('obj2')"><span class="term-tag">03–04</span><div class="term-body"><b>Ethics</b> — Why trust is foundational to accounting, and a framework for making ethical decisions.</div><span class="toc-arrow">↓</span></div>
          <div class="term toc-link" onclick="jumpTo('obj3')"><span class="term-tag">05–06</span><div class="term-body"><b>GAAP & Standards</b> — The rule structure (FASB, SEC, IASB/IFRS) and the two key qualities of useful information.</div><span class="toc-arrow">↓</span></div>
          <div class="term toc-link" onclick="jumpTo('obj4')"><span class="term-tag">07–08</span><div class="term-body"><b>Assumptions & Principles</b> — The four assumptions and three principles that shape every accounting decision.</div><span class="toc-arrow">↓</span></div>
          <div class="term toc-link" onclick="jumpTo('obj5')"><span class="term-tag">09–10</span><div class="term-body"><b>Accounting Equation</b> — Assets = Liabilities + Stockholders' Equity, and why it always balances.</div><span class="toc-arrow">↓</span></div>
          <div class="term toc-link" onclick="jumpTo('obj6')"><span class="term-tag">11–12</span><div class="term-body"><b>Transactions & Equity</b> — How to analyze transaction effects, plus Common Stock, Retained Earnings, and Dividends.</div><span class="toc-arrow">↓</span></div>
          <div class="term toc-link" onclick="jumpTo('obj7')"><span class="term-tag">13–17</span><div class="term-body"><b>Financial Statements</b> — All four statements in depth: purpose, structure, and how they connect.</div><span class="toc-arrow">↓</span></div>
          <div class="term toc-link" onclick="jumpTo('obj8')"><span class="term-tag">18–19</span><div class="term-body"><b>Review & Interrelationships</b> — How statements link together as a final accuracy check, plus glossary and study checklist.</div><span class="toc-arrow">↓</span></div>
        </div>
      </section>

      <!-- ===== OBJ 01–02: BUSINESS & USERS ===== -->
      <section class="section" id="obj1">
        <div class="section-title-row">
          <span class="obj-badge">Sections 01 – 02</span>
          <h2>Business Fundamentals & Users of Accounting</h2>
        </div>
        <p class="section-intro">A business is an organization that uses resources (inputs) to provide goods or services (outputs) to customers. Unit 1 focuses on service businesses — where the product is a service, not merchandise. Accounting exists because businesses need a structured way to measure and communicate financial activity.</p>

        <div class="terms">
          <div class="term"><span class="term-tag">Business</span><div class="term-body">An organization that provides goods or services using resources. Every business decision ultimately connects to whether the business is earning more than it spends.</div></div>
          <div class="term"><span class="term-tag">Service Business</span><div class="term-body">A business whose product is a service rather than physical merchandise — for example, a tutoring company, law firm, or consulting practice.</div></div>
          <div class="term"><span class="term-tag">Profit</span><div class="term-body">What remains after subtracting expenses from revenues. If a tutoring company earns $8,000 in fees but spends $5,500 on rent, wages, and internet, the profit is $2,500.</div></div>
          <div class="term"><span class="term-tag">Accounting</span><div class="term-body">An information system that provides reports to users about a business's economic activities and condition. It is the language businesses use to communicate what is happening financially.</div></div>
        </div>

        <div class="eq-box">
          <code>Profit = Revenues − Expenses</code>
          <button class="copy-btn" onclick="copyText('Profit = Revenues − Expenses')">Copy</button>
        </div>

        <div class="gaap-grid" style="margin-top:20px;">
          <div class="gaap-card">
            <div class="gaap-card-label">Internal Users</div>
            <p>People inside the business who use accounting reports to run operations — <b>managers, supervisors, owners</b> working day-to-day. They need detailed internal reports, some of which are confidential.</p>
          </div>
          <div class="gaap-card">
            <div class="gaap-card-label">External Users</div>
            <p>People outside the business who evaluate it from the outside — <b>creditors, investors, regulators, tax agencies, customers</b>. They rely on standardized public reports they can trust.</p>
          </div>
        </div>

        <div class="quiz-block" style="margin-top:20px;">
          <div class="quiz-label">Quick Check — What is profit equal to?</div>
          <input class="quiz-input" id="q_profit" placeholder="Type the formula…" />
          <div class="quiz-row">
            <button class="quiz-check-btn" onclick="checkProfit()">Check Answer</button>
            <span class="result-badge" id="r_profit"></span>
            <span class="quiz-hint">Include both Revenues and Expenses.</span>
          </div>
        </div>
      </section>

      <!-- ===== OBJ 03–04: ETHICS ===== -->
      <section class="section" id="obj2">
        <div class="section-title-row">
          <span class="obj-badge">Sections 03 – 04</span>
          <h2>Ethics in Business & Accounting</h2>
        </div>
        <p class="section-intro">Accounting only works when users trust the information. Unethical accounting misleads owners, lenders, and employees — causing lawsuits, financial losses, and damaged reputations. Ethics is not just a personal value; it has real, measurable business consequences.</p>

        <div class="terms">
          <div class="term"><span class="term-tag">Ethics</span><div class="term-body">Choosing actions that are honest, fair, and responsible. In accounting, this means reporting what actually happened — not what would look most favorable.</div></div>
          <div class="term"><span class="term-tag">Why It Matters</span><div class="term-body">If a company records revenue that was not actually earned, the income statement looks stronger than reality. A lender might approve a loan based on false information — then both parties are harmed when the truth surfaces.</div></div>
        </div>

        <div class="gaap-card" style="margin-top:20px;">
          <div class="gaap-card-label">Framework for Ethical Decisions</div>
          <p style="line-height:1.8;">
            <b>Step 1 — Identify the issue.</b> Name the ethical problem clearly before reacting.<br>
            <b>Step 2 — List affected parties.</b> Who is impacted by each possible action?<br>
            <b>Step 3 — Evaluate consequences.</b> What are the short-term and long-term results?<br>
            <b>Step 4 — Choose the most honest, fair response.</b> Personal character and professional judgment both matter.
          </p>
        </div>

        <div class="quiz-block" style="margin-top:20px;">
          <div class="quiz-label">Quick Check — Why do accounting scandals affect more than just the company owners?</div>
          <input class="quiz-input" id="q_ethics" placeholder="Type your answer…" />
          <div class="quiz-row">
            <button class="quiz-check-btn" onclick="checkEthics()">Check Answer</button>
            <span class="result-badge" id="r_ethics"></span>
          </div>
        </div>
      </section>

      <!-- ===== OBJ 05–06: GAAP & USEFUL INFO ===== -->
      <section class="section" id="obj3">
        <div class="section-title-row">
          <span class="obj-badge">Sections 05 – 06</span>
          <h2>GAAP, Standards & Useful Financial Information</h2>
        </div>
        <p class="section-intro">GAAP is the shared rulebook for financial reporting in the United States. Without it, two companies could record identical transactions in totally different ways — making their statements impossible to compare. Standards are set by specific organizations, and reports are only valuable if they have two key qualities.</p>

        <div class="gaap-grid">
          <div class="gaap-card">
            <div class="gaap-card-label">Standard Setters</div>
            <p>
              <b>GAAP</b> — Generally Accepted Accounting Principles. U.S. guidelines for financial reporting.<br><br>
              <b>FASB</b> — Financial Accounting Standards Board. Private-sector body that writes most U.S. standards.<br><br>
              <b>SEC</b> — Securities and Exchange Commission. Federal agency overseeing public-company disclosures.<br><br>
              <b>IASB / IFRS</b> — International Accounting Standards Board issues IFRS, used in many countries outside the U.S.
            </p>
          </div>
          <div class="gaap-card">
            <div class="gaap-card-label">Two Qualities of Useful Information</div>
            <p>
              <b>Relevance</b> — Information is relevant if it can influence a decision. If a report omits major unpaid bills, it is less relevant for a lender evaluating creditworthiness.<br><br>
              <b>Faithful Representation</b> — Information faithfully represents what actually happened in the business. It reflects economic reality, not just what looks favorable.
            </p>
          </div>
        </div>

        <div style="margin-top: 20px;">
          <div class="quiz-label" style="font-size: 13px; color: var(--muted); margin-bottom: 10px;">Flashcard — click to reveal</div>
          <div class="flashcard" id="fc1" onclick="flipCard('fc1', 'What does GAAP stand for?', 'Generally Accepted Accounting Principles')">What does GAAP stand for?</div>
        </div>
        <div style="margin-top:12px;">
          <div class="flashcard" id="fc2" onclick="flipCard('fc2', 'Who writes most U.S. accounting standards?', 'FASB — Financial Accounting Standards Board (not the SEC)')">Who writes most U.S. accounting standards?</div>
        </div>
      </section>

      <!-- ===== OBJ 07–08: ASSUMPTIONS & PRINCIPLES ===== -->
      <section class="section" id="obj4">
        <div class="section-title-row">
          <span class="obj-badge">Sections 07 – 08</span>
          <h2>Assumptions & Principles</h2>
        </div>
        <p class="section-intro">Assumptions explain how accountants organize information — they are the structural rules under everything. Principles explain how specific events get recorded. Together they ensure accounting reports are consistent, reliable, and comparable across businesses.</p>

        <div class="gaap-grid">
          <div class="gaap-card">
            <div class="gaap-card-label">The Four Assumptions</div>
            <p>
              <b>Monetary Unit</b> — Transactions are measured in a stable currency (dollars). Non-monetary events are not recorded.<br><br>
              <b>Time Period</b> — Results are reported for a specific period — monthly, quarterly, or annually.<br><br>
              <b>Business Entity</b> — The business's records are kept completely separate from the owner's personal records. Personal grocery spending does not go on the business books.<br><br>
              <b>Going Concern</b> — The business is assumed to continue operating. This justifies recording long-term assets at cost rather than liquidation value.
            </p>
          </div>
          <div class="gaap-card">
            <div class="gaap-card-label">The Three Principles</div>
            <p>
              <b>Historical Cost (Measurement)</b> — Assets are recorded at their original transaction cost. A van purchased for $18,000 stays on the books at $18,000 even if market value later changes. Historical cost is more objective and verifiable than estimates.<br><br>
              <b>Revenue Recognition</b> — Record revenue when it is earned, not necessarily when cash is received.<br><br>
              <b>Expense Recognition</b> — Match expenses to the same period as the revenues they helped produce.
            </p>
          </div>
        </div>

        <div class="quiz-block" style="margin-top:20px;">
          <div class="quiz-label">Quick Check — Which assumption allows a company to report monthly results?</div>
          <input class="quiz-input" id="q_assumption" placeholder="Name the assumption…" />
          <div class="quiz-row">
            <button class="quiz-check-btn" onclick="checkAssumption()">Check Answer</button>
            <span class="result-badge" id="r_assumption"></span>
          </div>
        </div>
      </section>

      <!-- ===== OBJ 09–10: ACCOUNTING EQUATION ===== -->
      <section class="section" id="obj5">
        <div class="section-title-row">
          <span class="obj-badge">Sections 09 – 10</span>
          <h2>The Accounting Equation</h2>
        </div>
        <p class="section-intro">Once a business is treated as its own entity, we can track what it owns (assets) and who has claims to those assets. Claims come from two sources: creditors (liabilities) and owners (stockholders' equity). That relationship is the accounting equation — and every transaction must keep it in balance.</p>

        <div class="eq-box">
          <code>Assets = Liabilities + Stockholders' Equity</code>
          <button class="copy-btn" onclick="copyText('Assets = Liabilities + Stockholders Equity')">Copy</button>
        </div>

        <div class="terms" style="margin-top:16px;">
          <div class="term"><span class="term-tag">Assets</span><div class="term-body">Resources owned by the business — cash, accounts receivable, supplies, equipment, land. Assets are on the left side of the equation.</div></div>
          <div class="term"><span class="term-tag">Liabilities</span><div class="term-body">Amounts owed to creditors — accounts payable, notes payable, wages payable. Creditors have the first claim on assets.</div></div>
          <div class="term"><span class="term-tag">Stockholders' Equity</span><div class="term-body">The owners' residual claim to assets after liabilities are satisfied. Made up of Common Stock (investment) and Retained Earnings (cumulative profits kept in the business).</div></div>
        </div>

        <div class="gaap-card" style="margin-top:16px;">
          <div class="gaap-card-label">Example — Owner Investment</div>
          <p>Owner invests <b>$12,000 cash</b> into the corporation. Cash (an asset) increases $12,000. Common Stock (stockholders' equity) increases $12,000. The equation stays balanced: <b>$12,000 = $0 + $12,000</b>.</p>
        </div>

        <p style="font-size:13px; color:var(--muted); margin-top:16px; line-height:1.7;">Use the simulator below. Move Assets and watch what must happen on the right side. The goal: train your eye to immediately think, "if one side changes, the other side must also change."</p>
      </section>

      <!-- ===== EQUATION SIMULATOR ===== -->
      <section class="section" id="eqPractice">
        <div class="sim-header">
          <h3>Equation Visualizer</h3>
          <div class="sim-controls">
            <button class="sim-btn" id="abBtn" onclick="toggleAutoBalance()">Auto-Balance: <span id="abStatus">ON</span></button>
            <button class="sim-btn" onclick="resetSliders()">Reset</button>
          </div>
        </div>
        <div class="slider-grid">
          <div class="slider-card">
            <div class="slider-row"><span class="slider-label">ΔAssets</span><span class="slider-val" id="aVal">$0</span></div>
            <input type="range" min="0" max="1000000" value="0" step="1000" id="assetsSlider" oninput="syncFromAssets()" />
          </div>
          <div class="slider-card">
            <div class="slider-row"><span class="slider-label">ΔLiabilities</span><span class="slider-val" id="lVal">$0</span></div>
            <input type="range" min="0" max="1000000" value="0" step="1000" id="liabSlider" oninput="manualChange('L')" />
          </div>
          <div class="slider-card">
            <div class="slider-row"><span class="slider-label">ΔEquity</span><span class="slider-val" id="eVal">$0</span></div>
            <input type="range" min="0" max="1000000" value="0" step="1000" id="eqSlider" oninput="manualChange('E')" />
          </div>
          <div class="slider-card">
            <div class="slider-row"><span class="slider-label">Status</span><span id="eqStatus" style="font-family:'DM Mono',monospace;font-size:13px;color:var(--green);">Balanced ✓</span></div>
            <div class="slider-mini" id="eqHint">Move Assets first — watch the other side auto-adjust. Then turn off Auto-Balance and try to balance it yourself.</div>
          </div>
        </div>
        <div class="eq-line-display">
          <code id="eqLine">ΔA ($0) = ΔL ($0) + ΔE ($0)</code>
          <button class="copy-btn" onclick="copyText(document.getElementById('eqLine').innerText)">Copy</button>
        </div>
      </section>

      <!-- ===== OBJ 11–12: TRANSACTIONS & EQUITY ===== -->
      <section class="section" id="obj6">
        <div class="section-title-row">
          <span class="obj-badge">Sections 11 – 12</span>
          <h2>Transaction Analysis & Stockholders' Equity</h2>
        </div>
        <p class="section-intro">A business transaction is any event that changes the financial condition of the business. Every transaction has at least two effects — and the accounting equation must still balance after every single one. Stockholders' equity has components that increase it and components that pull it down.</p>

        <div class="gaap-grid">
          <div class="gaap-card">
            <div class="gaap-card-label">Transaction Analysis Rules</div>
            <p>
              Every transaction affects at least two accounts. Some shift amounts within the same side — buying land for cash keeps total assets the same, Land up, Cash down. Others change both sides of the equation.<br><br>
              <b>Always identify the exact accounts affected</b> — not just "assets went up." Ask: which specific asset? Which specific liability or equity account?
            </p>
          </div>
          <div class="gaap-card">
            <div class="gaap-card-label">Stockholders' Equity — What Increases It</div>
            <p>
              <b>Common Stock</b> — increases when owners invest cash or other assets into the corporation.<br><br>
              <b>Retained Earnings</b> — cumulative earnings kept in the business. Increases with net income, decreases with net loss and dividends.<br><br>
              <b>Revenue</b> — when the business earns fees or makes sales, revenue increases, which flows into Retained Earnings and grows equity.
            </p>
          </div>
        </div>

        <!-- Contra Equity — Expenses & Dividends -->
        <div class="gaap-card" style="margin-top:28px; border-left-color: rgba(240,96,96,.5);">
          <div class="gaap-card-label" style="color:var(--red);">Contra Equity — Expenses & Dividends</div>
          <p>
            Not everything in equity goes up. <b>Expenses and Dividends are contra equity accounts</b> — they work against stockholders' equity, pulling it down instead of building it up.<br><br>
            <b>Expenses</b> carry a <b>debit balance</b> by nature. In accounting, assets and expenses both have normal debit balances — but where assets represent value the business owns, expenses represent value consumed to generate revenue. When you debit an expense account, you increase the expense, which reduces net income, which reduces Retained Earnings, which shrinks stockholders' equity. The chain is: <em>Expense up → Net Income down → Retained Earnings down → Equity down.</em><br><br>
            <b>Dividends</b> also carry a debit balance and work the same way — debiting Dividends increases the account, which directly reduces Retained Earnings. But unlike expenses, dividends never appear on the income statement. They are a distribution of profit to owners, not a cost of doing business.<br><br>
            This is why the income statement formula works the way it does. Revenues credit (increase) equity. Expenses debit (decrease) equity. Net income is what is left after the expenses have done their work against the revenues.
          </p>
        </div>

        <div class="terms" style="margin-top:24px;">
          <div class="term">
            <span class="term-tag">Common Stock</span>
            <div class="term-body"><b>Credit balance.</b> Increases when owners invest. Recorded on the right side of the equation — it is a permanent, stable part of equity.</div>
          </div>
          <div class="term">
            <span class="term-tag">Retained Earnings</span>
            <div class="term-body"><b>Credit balance (normally).</b> Cumulative net income kept in the business. Net income adds to it; net loss and dividends subtract from it. If losses exceed all prior earnings, the balance turns debit — called a deficit.</div>
          </div>
          <div class="term">
            <span class="term-tag">Revenue</span>
            <div class="term-body"><b>Credit balance.</b> Increases equity. When a service is performed or a sale is made, the revenue account is credited — it eventually flows into Retained Earnings through the closing process.</div>
          </div>
          <div class="term">
            <span class="term-tag">Expenses</span>
            <div class="term-body"><b>Debit balance — contra equity.</b> Expenses are costs incurred to generate revenue. Their normal balance is a debit, which is the opposite of equity. Every dollar of expense debited reduces net income and, through that, reduces Retained Earnings. Examples: rent expense, wages expense, utilities expense.</div>
          </div>
          <div class="term">
            <span class="term-tag">Dividends</span>
            <div class="term-body"><b>Debit balance — contra equity.</b> Distributions of earnings to stockholders. Like expenses, dividends carry a debit balance that reduces equity — but they are <em>not</em> an expense and never appear on the income statement. They reduce Retained Earnings directly. If a corporation earns $3,000 profit and pays $500 in dividends, Retained Earnings rises by a net $2,500.</div>
          </div>
        </div>

        <div class="eq-box" style="margin-top:24px;">
          <code>Equity = Common Stock + Retained Earnings + Revenue − Expenses − Dividends</code>
          <button class="copy-btn" onclick="copyText('Equity = Common Stock + Retained Earnings + Revenue − Expenses − Dividends')">Copy</button>
        </div>

        <div class="gaap-card" style="margin-top:24px;">
          <div class="gaap-card-label">Common Transaction Effects — Reference Table</div>
          <div class="table-wrap" style="margin-top:10px;">
            <table>
              <thead>
                <tr><th>Transaction</th><th>Effect on Accounts</th><th>Equity Impact</th></tr>
              </thead>
              <tbody>
                <tr><td>Owner invests cash</td><td>Cash ↑ | Common Stock ↑</td><td style="color:var(--green);">↑ Increases</td></tr>
                <tr><td>Buy supplies for cash</td><td>Supplies ↑ | Cash ↓</td><td style="color:var(--muted2);">No change</td></tr>
                <tr><td>Buy equipment on account</td><td>Equipment ↑ | Accounts Payable ↑</td><td style="color:var(--muted2);">No change</td></tr>
                <tr><td>Earn revenue for cash</td><td>Cash ↑ | Revenue ↑</td><td style="color:var(--green);">↑ Increases</td></tr>
                <tr><td>Earn revenue on account</td><td>Accounts Receivable ↑ | Revenue ↑</td><td style="color:var(--green);">↑ Increases</td></tr>
                <tr><td>Pay expense in cash</td><td>Cash ↓ | Expense ↑ (debit)</td><td style="color:var(--red);">↓ Decreases</td></tr>
                <tr><td>Pay supplier on account</td><td>Cash ↓ | Accounts Payable ↓</td><td style="color:var(--muted2);">No change</td></tr>
                <tr><td>Collect from customer</td><td>Cash ↑ | Accounts Receivable ↓</td><td style="color:var(--muted2);">No change</td></tr>
                <tr><td>Pay dividends</td><td>Cash ↓ | Dividends ↑ (debit)</td><td style="color:var(--red);">↓ Decreases</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="quiz-block" style="margin-top:28px;">
          <div class="quiz-label">Quick Check — Why do expenses carry a debit balance if they are part of stockholders' equity?</div>
          <input class="quiz-input" id="q_contra" placeholder="Type your answer…" />
          <div class="quiz-row">
            <button class="quiz-check-btn" onclick="checkContra()">Check Answer</button>
            <span class="result-badge" id="r_contra"></span>
          </div>
        </div>
      </section>

      <!-- ===== JOURNAL ENTRY TOOL ===== -->
      <section class="section" id="jePractice">
        <div class="sim-header">
          <h3>Try a Journal Entry</h3>
        </div>
        <div class="je-grid">
          <select class="je-select" id="debitType">
            <option value="Asset">Debit — Asset</option>
            <option value="Liability">Debit — Liability</option>
            <option value="Equity">Debit — Equity</option>
            <option value="Revenue">Debit — Revenue</option>
            <option value="Expense">Debit — Expense</option>
            <option value="Dividends">Debit — Dividends</option>
          </select>
          <select class="je-select" id="creditType">
            <option value="Asset">Credit — Asset</option>
            <option value="Liability" selected>Credit — Liability</option>
            <option value="Equity">Credit — Equity</option>
            <option value="Revenue">Credit — Revenue</option>
            <option value="Expense">Credit — Expense</option>
            <option value="Dividends">Credit — Dividends</option>
          </select>
          <input class="je-input" type="number" id="jeAmount" placeholder="Amount $" min="0" step="100" />
          <div style="display:flex;gap:8px;">
            <button class="je-btn add" onclick="addEntry()" style="flex:1;">Add</button>
          </div>
        </div>
        <div class="je-row">
          <button class="je-btn undo" onclick="undoEntry()">↩ Undo</button>
          <button class="je-btn reset" onclick="resetJournal()">Reset All</button>
          <span class="result-badge" id="jeStatus"></span>
        </div>
        <div class="balances-row" style="margin-top:18px;">
          <div class="bal-card"><div class="bal-key">Assets</div><div class="bal-val" id="balA">$0</div></div>
          <div class="bal-card"><div class="bal-key">Liabilities</div><div class="bal-val" id="balL">$0</div></div>
          <div class="bal-card"><div class="bal-key">Equity</div><div class="bal-val" id="balE">$0</div></div>
        </div>
        <div class="eq-line-display" style="margin-bottom:12px;">
          <code id="balEqLine">A ($0) = L ($0) + E ($0)</code>
          <button class="copy-btn" onclick="copyText(document.getElementById('balEqLine').innerText)">Copy</button>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr><th>#</th><th>Debit</th><th>Credit</th><th>Amount</th><th>ΔAssets</th><th>ΔLiab</th><th>ΔEquity</th></tr>
            </thead>
            <tbody id="jeBody">
              <tr><td colspan="7" style="color:var(--muted2);text-align:center;padding:20px;">No entries yet.</td></tr>
            </tbody>
          </table>
        </div>
        <div class="je-note">
          <b>Debits</b> increase Assets and Expenses; decrease Liabilities, Equity, and Revenue. <b>Credits</b> do the opposite. This table converts those effects into changes in A/L/E so you can track the equation impact of each transaction.
        </div>
      </section>

      <!-- ===== OBJ 13–17: FINANCIAL STATEMENTS ===== -->
      <section class="section" id="obj7">
        <div class="section-title-row">
          <span class="obj-badge">Sections 13 – 17</span>
          <h2>The Four Financial Statements</h2>
        </div>
        <p class="section-intro">The four statements are prepared in a specific order because each one feeds into the next. Net income flows from the income statement to the retained earnings statement. Ending retained earnings flows to the balance sheet. Ending cash on the cash flow statement must match the cash on the balance sheet.</p>

        <div class="statements-list">
          <div class="stmt-row">
            <div class="stmt-num">1</div>
            <div class="stmt-text">
              <b>Income Statement</b>
              <p>Covers a period of time. Reports revenues and expenses and produces net income or net loss. Answers: was the business profitable during this period?</p>
            </div>
          </div>
          <div class="stmt-row">
            <div class="stmt-num">2</div>
            <div class="stmt-text">
              <b>Retained Earnings Statement</b>
              <p>Covers a period of time. Shows the change in retained earnings: Beginning RE + Net Income − Dividends = Ending RE. Bridges profitability to the balance sheet.</p>
            </div>
          </div>
          <div class="stmt-row">
            <div class="stmt-num">3</div>
            <div class="stmt-text">
              <b>Balance Sheet</b>
              <p>Reports on a specific date — a snapshot. Shows assets, liabilities, and stockholders' equity. Built from the accounting equation, so both sides must be equal.</p>
            </div>
          </div>
          <div class="stmt-row">
            <div class="stmt-num">4</div>
            <div class="stmt-text">
              <b>Statement of Cash Flows</b>
              <p>Covers a period of time. Summarizes cash receipts and payments in three buckets: operating (day-to-day), investing (long-term assets), and financing (owners and lenders).</p>
            </div>
          </div>
        </div>

        <div class="gaap-grid" style="margin-top:32px;">
          <div class="gaap-card">
            <div class="gaap-card-label">Income Statement in practice</div>
            <p>Net Income = Revenues − Expenses. If expenses exceed revenues it's a net loss.<br><br><b>Example:</b> Fees Earned $28,000 minus total expenses $19,500 = net income <b>$8,500</b>.</p>
          </div>
          <div class="gaap-card">
            <div class="gaap-card-label">Retained Earnings Statement in practice</div>
            <p>Beginning RE + Net Income − Dividends = Ending RE.<br><br><b>Example:</b> $5,000 + $9,200 − $1,000 = Ending RE <b>$13,200</b>.</p>
          </div>
          <div class="gaap-card">
            <div class="gaap-card-label">Balance Sheet in practice</div>
            <p>Reported on one date, not a period. Assets listed in order of liquidity.<br><br><b>Example:</b> Total Assets $40,000, Liabilities $14,000 → Stockholders' Equity must be <b>$26,000</b>.</p>
          </div>
          <div class="gaap-card">
            <div class="gaap-card-label">Cash Flows in practice</div>
            <p>Operating: cash from customers. Investing: buying equipment. Financing: issuing stock or borrowing.<br><br>A company can report net income and still have a <b>decrease in cash</b>.</p>
          </div>
        </div>

        <div class="quiz-block" style="margin-top:24px;">
          <div class="quiz-label">Mastery Check — Which statement reports assets, liabilities, and equity at a specific date?</div>
          <input class="quiz-input" id="q_bs" placeholder="Type your answer…" />
          <div class="quiz-row">
            <button class="quiz-check-btn" onclick="checkBalanceSheet()">Check Answer</button>
            <span class="result-badge" id="r_bs"></span>
          </div>
        </div>
      </section>

      <!-- ===== OBJ 18–19: REVIEW, INTERRELATIONSHIPS & GLOSSARY ===== -->
      <section class="section" id="obj8">
        <div class="section-title-row">
          <span class="obj-badge">Sections 18 – 19</span>
          <h2>Interrelationships, Review & Glossary</h2>
        </div>
        <p class="section-intro" style="margin-bottom:24px;">One of the most important Unit 1 ideas: the four statements connect in a chain, and those links let you catch errors. If your numbers don't flow correctly from one statement to the next, something is wrong.</p>

        <div class="gaap-card" style="margin-bottom:32px;">
          <div class="gaap-card-label">How the statements flow</div>
          <p style="line-height:2.1;">
            <b>Income Statement</b> → net income flows down to<br>
            <b>Retained Earnings Statement</b> → ending RE flows down to<br>
            <b>Balance Sheet</b> → ending cash here must match<br>
            <b>Statement of Cash Flows</b> ending cash
          </p>
          <p style="margin-top:14px;"><b>Error check example:</b> If the cash flow statement shows ending cash of $7,850 but the balance sheet shows $8,050, there's a $200 discrepancy to find and fix.</p>
        </div>

        <!-- Study Checklist — open, no box -->
        <div class="section-title-row" style="margin-bottom:16px;">
          <span class="obj-badge">Checklist</span>
          <h2 style="font-size:20px;">Before you move on</h2>
        </div>
        <div id="checklist" style="display:grid;gap:10px;margin-bottom:40px;"></div>

        <!-- Glossary — open prose rows -->
        <div class="section-title-row" style="margin-top:8px;margin-bottom:4px;">
          <span class="obj-badge">Glossary</span>
          <h2 style="font-size:20px;">Key Terms</h2>
        </div>
        <p style="font-size:14px;color:var(--muted2);margin-bottom:16px;">All 28 terms from this chapter. Click any term to highlight it.</p>
        <div class="terms" id="glossaryTerms"></div>
      </section>

      <!-- ===== CHAPTER SUMMARY ===== -->
      <section class="section" id="summary">
        <div class="section-title-row">
          <span class="obj-badge">Summary</span>
          <h2>Chapter Summary</h2>
        </div>
        <p class="section-intro">Accounting is a system for explaining what a business owns, owes, earns, and spends. The equation is the structural core. The financial statements are the final output — and they connect in a chain that must be consistent.</p>
        <div class="summary-list">
          <div class="summary-item"><span class="summary-num">01</span><div class="summary-text">Businesses use resources to provide goods or services and earn a profit. <b>Profit = Revenues − Expenses.</b> Accounting tracks and communicates this activity to both internal and external users.</div></div>
          <div class="summary-item"><span class="summary-num">02</span><div class="summary-text"><b>Ethics matters</b> because accounting only works when users trust the information. Poor ethics causes real harm to lenders, employees, investors — not just owners.</div></div>
          <div class="summary-item"><span class="summary-num">03</span><div class="summary-text"><b>GAAP</b> (written mainly by FASB, overseen by SEC) gives financial reporting its consistency. Reports must be relevant and faithfully represent what actually happened.</div></div>
          <div class="summary-item"><span class="summary-num">04</span><div class="summary-text">Four <b>assumptions</b> (monetary unit, time period, business entity, going concern) and three <b>principles</b> (historical cost, revenue recognition, expense recognition) define how and when things get recorded.</div></div>
          <div class="summary-item"><span class="summary-num">05</span><div class="summary-text">The accounting equation — <b>Assets = Liabilities + Stockholders' Equity</b> — must balance after every single transaction. Assets are resources owned; liabilities and equity are the two types of claims against them.</div></div>
          <div class="summary-item"><span class="summary-num">06</span><div class="summary-text">Every transaction has at least two effects. <b>Common Stock</b> reflects owner investment; <b>Retained Earnings</b> reflects cumulative profit kept; <b>Dividends</b> reduce equity but are not expenses.</div></div>
          <div class="summary-item"><span class="summary-num">07</span><div class="summary-text">The four statements flow in order: Income Statement → Retained Earnings Statement → Balance Sheet → Statement of Cash Flows. <b>Each feeds into the next</b>, and those connections let you catch errors.</div></div>
        </div>
      </section>

      <!-- ===== CHAPTER RECAP QUIZ ===== -->
      <div class="recap-quiz" id="recapQuiz">
        <div class="recap-header">
          <span class="obj-badge">Recap Quiz</span>
          <h2>Test yourself on Chapter 1</h2>
        </div>
        <p class="recap-intro">10 questions covering the whole chapter. Select an answer for each, then hit Submit to see your score and explanations.</p>

        <div class="rq-item">
          <div class="rq-q"><span class="rq-num">01</span>What is the correct formula for profit?</div>
          <div class="rq-options" data-correct="b">
            <div class="rq-option" data-val="a"><span class="rq-letter">A</span> Revenues + Expenses</div>
            <div class="rq-option" data-val="b"><span class="rq-letter">B</span> Revenues − Expenses</div>
            <div class="rq-option" data-val="c"><span class="rq-letter">C</span> Assets − Liabilities</div>
            <div class="rq-option" data-val="d"><span class="rq-letter">D</span> Expenses − Revenues</div>
          </div>
          <div class="rq-feedback">Profit = Revenues − Expenses. If expenses exceed revenues, it's a net loss, not a profit.</div>
        </div>

        <div class="rq-item">
          <div class="rq-q"><span class="rq-num">02</span>Which organization writes most U.S. accounting standards?</div>
          <div class="rq-options" data-correct="c">
            <div class="rq-option" data-val="a"><span class="rq-letter">A</span> SEC</div>
            <div class="rq-option" data-val="b"><span class="rq-letter">B</span> IASB</div>
            <div class="rq-option" data-val="c"><span class="rq-letter">C</span> FASB</div>
            <div class="rq-option" data-val="d"><span class="rq-letter">D</span> IRS</div>
          </div>
          <div class="rq-feedback">FASB (Financial Accounting Standards Board) is the private-sector body that develops GAAP in the U.S. The SEC enforces reporting rules but doesn't write the standards.</div>
        </div>

        <div class="rq-item">
          <div class="rq-q"><span class="rq-num">03</span>The business entity assumption means:</div>
          <div class="rq-options" data-correct="b">
            <div class="rq-option" data-val="a"><span class="rq-letter">A</span> The business is assumed to continue operating indefinitely</div>
            <div class="rq-option" data-val="b"><span class="rq-letter">B</span> The business's financial records are kept separate from the owner's personal records</div>
            <div class="rq-option" data-val="c"><span class="rq-letter">C</span> All transactions must be measured in dollars</div>
            <div class="rq-option" data-val="d"><span class="rq-letter">D</span> Results are reported for a specific period</div>
          </div>
          <div class="rq-feedback">Business entity: keep business and personal transactions completely separate. If the owner pays personal grocery bills, that never touches the business books.</div>
        </div>

        <div class="rq-item">
          <div class="rq-q"><span class="rq-num">04</span>Assets = Liabilities + Stockholders' Equity. If assets increase by $8,000 and liabilities do not change, what happens to equity?</div>
          <div class="rq-options" data-correct="a">
            <div class="rq-option" data-val="a"><span class="rq-letter">A</span> Equity increases by $8,000</div>
            <div class="rq-option" data-val="b"><span class="rq-letter">B</span> Equity decreases by $8,000</div>
            <div class="rq-option" data-val="c"><span class="rq-letter">C</span> Equity stays the same</div>
            <div class="rq-option" data-val="d"><span class="rq-letter">D</span> Cannot be determined</div>
          </div>
          <div class="rq-feedback">The equation must balance: A = L + E. If assets go up $8,000 and liabilities don't move, equity must go up $8,000 to keep both sides equal.</div>
        </div>

        <div class="rq-item">
          <div class="rq-q"><span class="rq-num">05</span>An owner invests $15,000 cash into the corporation. Which accounts are affected?</div>
          <div class="rq-options" data-correct="b">
            <div class="rq-option" data-val="a"><span class="rq-letter">A</span> Cash increases; Retained Earnings increases</div>
            <div class="rq-option" data-val="b"><span class="rq-letter">B</span> Cash increases; Common Stock increases</div>
            <div class="rq-option" data-val="c"><span class="rq-letter">C</span> Cash increases; Revenue increases</div>
            <div class="rq-option" data-val="d"><span class="rq-letter">D</span> Accounts Receivable increases; Common Stock increases</div>
          </div>
          <div class="rq-feedback">Owner investment in a corporation = Cash (asset) up + Common Stock (equity) up. Retained Earnings only increases with net income.</div>
        </div>

        <div class="rq-item">
          <div class="rq-q"><span class="rq-num">06</span>Which financial statement is prepared first?</div>
          <div class="rq-options" data-correct="b">
            <div class="rq-option" data-val="a"><span class="rq-letter">A</span> Balance Sheet</div>
            <div class="rq-option" data-val="b"><span class="rq-letter">B</span> Income Statement</div>
            <div class="rq-option" data-val="c"><span class="rq-letter">C</span> Statement of Cash Flows</div>
            <div class="rq-option" data-val="d"><span class="rq-letter">D</span> Retained Earnings Statement</div>
          </div>
          <div class="rq-feedback">Order: Income Statement → Retained Earnings Statement → Balance Sheet → Statement of Cash Flows. Net income from the income statement is needed before you can complete the retained earnings statement.</div>
        </div>

        <div class="rq-item">
          <div class="rq-q"><span class="rq-num">07</span>Dividends are best described as:</div>
          <div class="rq-options" data-correct="c">
            <div class="rq-option" data-val="a"><span class="rq-letter">A</span> An expense on the income statement</div>
            <div class="rq-option" data-val="b"><span class="rq-letter">B</span> An increase to retained earnings</div>
            <div class="rq-option" data-val="c"><span class="rq-letter">C</span> A distribution of earnings that reduces retained earnings</div>
            <div class="rq-option" data-val="d"><span class="rq-letter">D</span> A liability owed to creditors</div>
          </div>
          <div class="rq-feedback">Dividends reduce Retained Earnings (equity) but are NOT an expense — they never appear on the income statement.</div>
        </div>

        <div class="rq-item">
          <div class="rq-q"><span class="rq-num">08</span>The balance sheet reports on:</div>
          <div class="rq-options" data-correct="a">
            <div class="rq-option" data-val="a"><span class="rq-letter">A</span> A specific date</div>
            <div class="rq-option" data-val="b"><span class="rq-letter">B</span> A period of time</div>
            <div class="rq-option" data-val="c"><span class="rq-letter">C</span> The current fiscal year only</div>
            <div class="rq-option" data-val="d"><span class="rq-letter">D</span> An estimated future date</div>
          </div>
          <div class="rq-feedback">The balance sheet is a snapshot — it shows financial position on one specific date (e.g., December 31, 2024). The other three statements cover a period of time.</div>
        </div>

        <div class="rq-item">
          <div class="rq-q"><span class="rq-num">09</span>Which accounting principle says assets should be recorded at their original transaction cost?</div>
          <div class="rq-options" data-correct="c">
            <div class="rq-option" data-val="a"><span class="rq-letter">A</span> Revenue recognition principle</div>
            <div class="rq-option" data-val="b"><span class="rq-letter">B</span> Going concern assumption</div>
            <div class="rq-option" data-val="c"><span class="rq-letter">C</span> Historical cost principle</div>
            <div class="rq-option" data-val="d"><span class="rq-letter">D</span> Business entity assumption</div>
          </div>
          <div class="rq-feedback">Historical cost: record assets at what you paid for them. A van bought for $18,000 stays on the books at $18,000 even if its resale value changes later.</div>
        </div>

        <div class="rq-item">
          <div class="rq-q"><span class="rq-num">10</span>A company earns net income of $12,000 and pays $2,000 in dividends. Beginning retained earnings were $5,000. What is ending retained earnings?</div>
          <div class="rq-options" data-correct="c">
            <div class="rq-option" data-val="a"><span class="rq-letter">A</span> $10,000</div>
            <div class="rq-option" data-val="b"><span class="rq-letter">B</span> $19,000</div>
            <div class="rq-option" data-val="c"><span class="rq-letter">C</span> $15,000</div>
            <div class="rq-option" data-val="d"><span class="rq-letter">D</span> $17,000</div>
          </div>
          <div class="rq-feedback">$5,000 + $12,000 − $2,000 = $15,000. Beginning RE + Net Income − Dividends = Ending RE.</div>
        </div>

        <button class="recap-submit" id="recapSubmit" onclick="submitRecap()">Submit Answers</button>

        <div class="recap-score" id="recapScore">
          <div class="recap-score-num" id="recapScoreNum">—</div>
          <div class="recap-score-label" id="recapScoreLabel">out of 10</div>
        </div>
      </div>

      <!-- ===== NEXT CHAPTER BUTTON ===== -->
      <div class="next-chapter-bar">
        <div class="next-chapter-info">
          <strong>Up next</strong>
          Chapter 2 — coming soon
        </div>
        <a href="#" class="btn-next-chapter" onclick="openChapterModal(); return false;">
          Next Chapter
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
        </a>
      </div>

      <div class="ch-footer">
        Accounting By Noah &nbsp;·&nbsp; Chapter 01 of 14 &nbsp;·&nbsp; Equation tools included
      </div>
      </div>

    </main>
  </div>

  <script>
    // ===== Chapter Navigation =====
    const chapters = Array.from({length: 14}, (_, i) => {
      const n = i + 1;
      return { num: n, title: n === 1 ? "Intro to Accounting & Business" : "Coming Soon", status: n === 1 ? "Active" : "Planned", active: n === 1 };
    });

    const chapterList = document.getElementById("chapterList");
    const chapterSelect = document.getElementById("chapterSelect");

    function renderChapters() {
      chapterList.innerHTML = "";
      chapters.forEach(ch => {
        const btn = document.createElement("button");
        btn.className = "ch-btn" + (ch.active ? " active" : "");
        btn.onclick = () => goChapter(ch.num);
        btn.innerHTML = `
          <div class="ch-num">${String(ch.num).padStart(2,'0')}</div>
          <div class="ch-text">
            <b>${escapeHtml(ch.title)}</b>
            <span>${escapeHtml(ch.status)}</span>
          </div>
        `;
        chapterList.appendChild(btn);
      });
    }

    function goChapter(n) {
      chapters.forEach(c => c.active = (c.num === n));
      renderChapters();
      chapterSelect.value = String(n);
      if (n === 1) {
        document.getElementById("heroTitle").textContent = "Introduction to Accounting & Business";
        document.getElementById("heroDesc").textContent = "19 sections covering everything from business fundamentals and ethics, through GAAP, the accounting equation, transaction analysis, and all four financial statements — plus a full glossary and study checklist.";
      } else {
        document.getElementById("heroTitle").textContent = `Chapter ${n} — Coming Soon`;
        document.getElementById("heroDesc").textContent = "This chapter slot is scaffolded and ready. Add lesson content and it will render here automatically.";
      }
      jumpTo("hero");
    }

    function selectChapterFromDropdown() {
      goChapter(parseInt(chapterSelect.value, 10));
    }

    // ===== Utilities =====
    function jumpTo(id) {
      const el = document.getElementById(id);
      if (el) el.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    let toastTimer;
    function showToast(msg) {
      const t = document.getElementById("toast");
      t.textContent = msg;
      t.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => t.classList.remove("show"), 1400);
    }

    function copyText(text) {
      navigator.clipboard.writeText(text).then(() => showToast("Copied")).catch(() => showToast("Copy failed"));
    }

    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, m => ({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[m]);
    }

    // ===== Quiz Checks =====
    function checkProfit() {
      const v = (document.getElementById("q_profit").value || "").toLowerCase();
      const ok = (v.includes("revenue") || v.includes("revenues")) && (v.includes("expense") || v.includes("expenses"));
      setResult("r_profit", ok ? "Correct ✓" : "Answer: Profit = Revenues − Expenses", ok ? "good" : "bad");
      if (ok) spawnConfetti(document.querySelector('#obj1 .quiz-check-btn'));
    }

    function checkEthics() {
      const v = (document.getElementById("q_ethics").value || "").toLowerCase();
      const ok = v.includes("stakeholder") || v.includes("lender") || v.includes("employee") || v.includes("investor") || v.includes("others") || v.includes("many") || v.includes("trust") || v.includes("rely");
      setResult("r_ethics", ok ? "Correct ✓" : "Because lenders, employees, investors, and customers all rely on accurate accounting info.", ok ? "good" : "bad");
      if (ok) spawnConfetti(document.querySelector('#obj2 .quiz-check-btn'));
    }

    function checkContra() {
      const v = (document.getElementById("q_contra").value || "").toLowerCase();
      const ok = v.includes("contra") || v.includes("decrease") || v.includes("reduce") || v.includes("opposite") || (v.includes("debit") && (v.includes("equity") || v.includes("net income") || v.includes("retained")));
      setResult("r_contra", ok ? "Correct ✓" : "Expenses are contra equity — their debit balance is the opposite of equity's normal credit balance. Debiting an expense reduces net income, which reduces Retained Earnings, which shrinks equity.", ok ? "good" : "bad");
      if (ok) spawnConfetti(document.querySelector('#obj6 .quiz-check-btn'));
    }

    function checkAssumption() {
      const ok = v.includes("time period") || v.includes("time-period") || (v.includes("time") && v.includes("period"));
      setResult("r_assumption", ok ? "Correct ✓" : "Answer: Time Period Assumption", ok ? "good" : "bad");
      if (ok) spawnConfetti(document.querySelector('#obj4 .quiz-check-btn'));
    }

    function checkBalanceSheet() {
      const v = (document.getElementById("q_bs").value || "").toLowerCase();
      const ok = v.includes("balance");
      setResult("r_bs", ok ? "Correct ✓" : "Answer: Balance Sheet", ok ? "good" : "bad");
      if (ok) spawnConfetti(document.querySelector('#obj7 .quiz-check-btn'));
    }

    function setResult(id, msg, cls) {
      const el = document.getElementById(id);
      el.textContent = msg;
      el.className = "result-badge show " + cls;
    }

    // ===== Flashcard (multi-card support) =====
    const fcStates = {};
    function flipCard(id, question, answer) {
      const card = document.getElementById(id);
      fcStates[id] = !fcStates[id];
      card.textContent = fcStates[id] ? answer : question;
      card.classList.toggle("flipped", fcStates[id]);
    }

    // ===== Study Mode =====
    let studyMode = false;
    function toggleStudyMode() {
      studyMode = !studyMode;
      document.documentElement.style.setProperty("--bg", studyMode ? "#111418" : "#0d1117");
      document.documentElement.style.setProperty("--surface", studyMode ? "#1a1f27" : "#161b22");
      showToast(studyMode ? "Study Mode On" : "Study Mode Off");
    }

    // ===================================================
    // ANIMATION 1 — Equation Shake (unbalanced)
    // ===================================================
    function triggerShake(el) {
      el.classList.remove("shake");
      void el.offsetWidth; // force reflow
      el.classList.add("shake");
      el.addEventListener("animationend", () => el.classList.remove("shake"), { once: true });
    }

    // ===================================================
    // ANIMATION 2 — Slider Glow Pulse while dragging
    // ===================================================
    function initSliderGlow(slider) {
      function updateTrack() {
        const pct = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
        slider.style.setProperty("--pct", pct + "%");
        slider.style.background = `linear-gradient(90deg, rgba(45,186,126,.35) ${pct}%, rgba(255,255,255,.06) ${pct}%)`;
      }
      slider.addEventListener("mousedown",  () => slider.classList.add("dragging"));
      slider.addEventListener("touchstart", () => slider.classList.add("dragging"), { passive: true });
      slider.addEventListener("mouseup",    () => slider.classList.remove("dragging"));
      slider.addEventListener("touchend",   () => slider.classList.remove("dragging"));
      slider.addEventListener("input", updateTrack);
      updateTrack();
    }

    // ===================================================
    // ANIMATION 3 — Confetti Burst
    // ===================================================
    const CONFETTI_COLORS = ["#2dba7e","#d4a843","#4f9cf9","#f06060","#a78bfa","#fbbf24"];

    function spawnConfetti(btn) {
      if (!btn) return;
      const rect = btn.getBoundingClientRect();
      const cx = rect.left + rect.width / 2;
      const cy = rect.top + rect.height / 2;
      const count = 36;

      for (let i = 0; i < count; i++) {
        const dot = document.createElement("div");
        dot.className = "confetti-dot";
        const color = CONFETTI_COLORS[Math.floor(Math.random() * CONFETTI_COLORS.length)];
        const size  = 5 + Math.random() * 5;
        const isSquare = Math.random() > 0.5;
        dot.style.cssText = `
          left:${cx}px; top:${cy}px;
          width:${size}px; height:${size}px;
          background:${color};
          border-radius:${isSquare ? "2px" : "50%"};
        `;
        document.body.appendChild(dot);

        const angle   = (Math.PI * 2 * i) / count + (Math.random() - 0.5) * 0.5;
        const speed   = 90 + Math.random() * 140;
        const gravity = 180 + Math.random() * 120;
        const life    = 900 + Math.random() * 400;
        let vx = Math.cos(angle) * speed;
        let vy = Math.sin(angle) * speed - 60;
        let x  = cx, y = cy;
        const start = performance.now();

        (function animate(now) {
          const t = (now - start) / 1000;
          const progress = (now - start) / life;
          if (progress >= 1) { dot.remove(); return; }

          vy += gravity * (1/60);
          x += vx * (1/60);
          y += vy * (1/60);

          const opacity = 1 - Math.pow(progress, 2);
          const scale   = 1 - progress * 0.4;
          dot.style.transform = `translate(${x - cx}px, ${y - cy}px) scale(${scale}) rotate(${t * 360}deg)`;
          dot.style.opacity   = opacity;
          requestAnimationFrame(animate);
        })(start);
      }
    }

    // ===================================================
    // ANIMATION 4 — Journal Row Flash
    // ===================================================
    function flashRow(tr, cls) {
      tr.classList.add(cls);
      tr.addEventListener("animationend", () => tr.classList.remove(cls), { once: true });
    }

    // ===================================================
    // ANIMATION 5 — Floating Hero Particles
    // ===================================================
    function initHeroParticles() {
      const canvas = document.getElementById("heroParticleCanvas");
      const hero   = document.getElementById("hero");
      const ctx    = canvas.getContext("2d");
      let w, h, particles;

      function resize() {
        w = canvas.width  = hero.offsetWidth;
        h = canvas.height = hero.offsetHeight;
      }

      function makeParticle() {
        return {
          x: Math.random() * w,
          y: Math.random() * h,
          r: 0.8 + Math.random() * 1.4,
          vx: (Math.random() - 0.5) * 0.18,
          vy: -0.06 - Math.random() * 0.14,
          alpha: 0.1 + Math.random() * 0.35,
          flicker: Math.random() * Math.PI * 2,
          flickerSpeed: 0.008 + Math.random() * 0.012,
        };
      }

      function init() {
        resize();
        particles = Array.from({ length: 55 }, makeParticle);
      }

      function draw() {
        ctx.clearRect(0, 0, w, h);
        particles.forEach(p => {
          p.x += p.vx;
          p.y += p.vy;
          p.flicker += p.flickerSpeed;
          const a = p.alpha * (0.7 + 0.3 * Math.sin(p.flicker));

          if (p.x < -10) p.x = w + 10;
          if (p.x > w + 10) p.x = -10;
          if (p.y < -10) { p.y = h + 10; p.x = Math.random() * w; }

          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(45,186,126,${a})`;
          ctx.fill();
        });
        requestAnimationFrame(draw);
      }

      window.addEventListener("resize", () => { resize(); });
      init();
      draw();
    }

    // ===================================================
    // ANIMATION 6 — Gradient Mesh Shift
    // ===================================================
    function initGradientShift() {
      const hero = document.getElementById("hero");
      let t = 0;

      function update() {
        t += 0.003;
        const x1 = 50 + 50 * Math.sin(t * 0.7);
        const y1 = 40 + 20 * Math.cos(t * 0.5);
        const x2 = 50 + 50 * Math.cos(t * 0.4);
        const y2 = 60 + 20 * Math.sin(t * 0.9);

        hero.style.background = `
          radial-gradient(700px 280px at ${x1}% ${y1}%, rgba(45,186,126,.10), transparent),
          radial-gradient(600px 260px at ${x2}% ${y2}%, rgba(212,168,67,.07), transparent),
          var(--surface2)
        `;
        requestAnimationFrame(update);
      }
      update();
    }

    // ===================================================
    // ANIMATION 7 — Cursor Trail
    // ===================================================
    function initCursorTrail() {
      const canvas = document.getElementById("cursorCanvas");
      const ctx    = canvas.getContext("2d");
      let w = canvas.width  = window.innerWidth;
      let h = canvas.height = window.innerHeight;
      window.addEventListener("resize", () => {
        w = canvas.width  = window.innerWidth;
        h = canvas.height = window.innerHeight;
      });

      const TRAIL_LEN = 22;
      const trail = [];
      let mouse = { x: -200, y: -200 };
      let leader = { x: -200, y: -200 };

      window.addEventListener("mousemove", e => { mouse.x = e.clientX; mouse.y = e.clientY; });

      function draw() {
        // Lerp leader toward mouse
        leader.x += (mouse.x - leader.x) * 0.18;
        leader.y += (mouse.y - leader.y) * 0.18;

        trail.unshift({ x: leader.x, y: leader.y });
        if (trail.length > TRAIL_LEN) trail.pop();

        ctx.clearRect(0, 0, w, h);

        trail.forEach((pt, i) => {
          const progress = i / TRAIL_LEN;
          const radius   = (1 - progress) * 4.5;
          const alpha    = (1 - progress) * 0.45 * (1 - progress);

          ctx.beginPath();
          ctx.arc(pt.x, pt.y, Math.max(0.1, radius), 0, Math.PI * 2);
          ctx.fillStyle = `rgba(45,186,126,${alpha})`;
          ctx.fill();
        });

        requestAnimationFrame(draw);
      }
      draw();
    }

    // ===================================================
    // ANIMATION 8 — Falling Money
    // ===================================================
    function initFallingMoney() {
      const canvas = document.getElementById("moneyCanvas");
      const hero   = document.getElementById("hero");
      const ctx    = canvas.getContext("2d");
      let w, h;

      // Bill designs: foreground color, background fill, label
      const BILLS = [
        { bg: "#1a3a1e", fg: "#2dba7e",    label: "$100" },
        { bg: "#1e2f1a", fg: "#4ddf9a",    label: "$50"  },
        { bg: "#2a2010", fg: "#d4a843",    label: "$20"  },
        { bg: "#12201a", fg: "#1e9e68",    label: "$1"   },
      ];

      function resize() {
        w = canvas.width  = hero.offsetWidth;
        h = canvas.height = hero.offsetHeight;
      }

      function makeBill() {
        const bill = BILLS[Math.floor(Math.random() * BILLS.length)];
        const bw = 46 + Math.random() * 18;   // bill width
        const bh = bw * 0.44;                  // realistic aspect ratio
        const speed  = 0.55 + Math.random() * 1.1;
        const wobbleAmp   = 18 + Math.random() * 28;  // horizontal sway amplitude (px)
        const wobbleFreq  = 0.012 + Math.random() * 0.018;
        const wobblePhase = Math.random() * Math.PI * 2;
        const rotSpeed    = (Math.random() - 0.5) * 0.018; // radians per frame
        return {
          x:      Math.random() * (w + 60) - 30,
          y:      -bh - Math.random() * h * 0.6,   // stagger start positions
          bw, bh,
          speed,
          wobbleAmp, wobbleFreq, wobblePhase,
          rot:    (Math.random() - 0.5) * 0.5,
          rotSpeed,
          alpha:  0.13 + Math.random() * 0.22,
          bg:     bill.bg,
          fg:     bill.fg,
          label:  bill.label,
          frame:  0,
        };
      }

      function drawBill(b) {
        ctx.save();
        ctx.globalAlpha = b.alpha;
        ctx.translate(
          b.x + Math.sin(b.frame * b.wobbleFreq + b.wobblePhase) * b.wobbleAmp,
          b.y
        );
        ctx.rotate(b.rot);

        const rx = b.bw / 2, ry = b.bh / 2;
        const corner = 3;

        // Bill body
        ctx.beginPath();
        ctx.moveTo(-rx + corner, -ry);
        ctx.lineTo( rx - corner, -ry);
        ctx.quadraticCurveTo( rx, -ry,  rx, -ry + corner);
        ctx.lineTo( rx,  ry - corner);
        ctx.quadraticCurveTo( rx,  ry,  rx - corner,  ry);
        ctx.lineTo(-rx + corner,  ry);
        ctx.quadraticCurveTo(-rx,  ry, -rx,  ry - corner);
        ctx.lineTo(-rx, -ry + corner);
        ctx.quadraticCurveTo(-rx, -ry, -rx + corner, -ry);
        ctx.closePath();
        ctx.fillStyle = b.bg;
        ctx.fill();

        // Border line (inner)
        ctx.strokeStyle = b.fg;
        ctx.lineWidth = 0.7;
        ctx.globalAlpha = b.alpha * 0.6;
        ctx.beginPath();
        const pad = 2.5;
        ctx.rect(-rx + pad, -ry + pad, b.bw - pad * 2, b.bh - pad * 2);
        ctx.stroke();

        // Center oval portrait placeholder
        ctx.globalAlpha = b.alpha * 0.45;
        ctx.beginPath();
        ctx.ellipse(0, 0, rx * 0.22, ry * 0.52, 0, 0, Math.PI * 2);
        ctx.strokeStyle = b.fg;
        ctx.lineWidth = 0.8;
        ctx.stroke();

        // Dollar label (left)
        ctx.globalAlpha = b.alpha * 0.9;
        ctx.fillStyle = b.fg;
        ctx.font = `bold ${b.bh * 0.34}px "DM Mono", monospace`;
        ctx.textAlign = "left";
        ctx.textBaseline = "middle";
        ctx.fillText(b.label, -rx + 4.5, 0);

        // Dollar label (right, mirrored)
        ctx.textAlign = "right";
        ctx.fillText(b.label, rx - 4.5, 0);

        // Fine line serifs across bill
        ctx.globalAlpha = b.alpha * 0.15;
        ctx.strokeStyle = b.fg;
        ctx.lineWidth = 0.4;
        for (let i = -3; i <= 3; i++) {
          const lx = i * (rx * 0.28);
          ctx.beginPath();
          ctx.moveTo(lx, -ry + pad + 1);
          ctx.lineTo(lx, ry - pad - 1);
          ctx.stroke();
        }

        ctx.restore();
      }

      function init() {
        resize();
      }

      let bills = [];
      let initialized = false;

      function spawnInitialBills() {
        // Spread ~20 bills across the full height so they don't all arrive at once
        bills = Array.from({ length: 20 }, makeBill);
        // Distribute vertically at start so screen isn't empty
        bills.forEach(b => {
          b.y = Math.random() * (h + b.bh) - b.bh;
        });
      }

      function draw() {
        ctx.clearRect(0, 0, w, h);

        // Gradually spawn more bills up to cap of 22
        if (Math.random() < 0.018 && bills.length < 22) {
          bills.push(makeBill());
        }

        bills.forEach((b, i) => {
          b.frame++;
          b.y      += b.speed;
          b.rot    += b.rotSpeed;

          drawBill(b);

          // Recycle when off screen bottom
          if (b.y > h + b.bh + 10) {
            bills[i] = makeBill(); // reset from top
          }
        });

        requestAnimationFrame(draw);
      }

      window.addEventListener("resize", () => { resize(); });
      init();
      spawnInitialBills();
      draw();
    }
    let autoBalance = true;
    let leRatio = 0.5;
    const assetsSlider = document.getElementById("assetsSlider");
    const liabSlider   = document.getElementById("liabSlider");
    const eqSlider     = document.getElementById("eqSlider");

    function money(n) {
      return "$" + Math.max(0, Math.abs(n)).toLocaleString(undefined, { maximumFractionDigits: 0 });
    }

    function toggleAutoBalance() {
      autoBalance = !autoBalance;
      const btn = document.getElementById("abBtn");
      document.getElementById("abStatus").textContent = autoBalance ? "ON" : "OFF";
      btn.classList.toggle("active", autoBalance);
      document.getElementById("eqHint").textContent = autoBalance
        ? "Auto-Balance is ON. Assets are split between Liabilities and Equity in a fixed linked balance."
        : "Auto-Balance is OFF. Adjust any slider. Balance is checked live.";
      if (autoBalance) syncFromAssets();
      updateEqViz();
    }

    function resetSliders() {
      leRatio = 0.5;
      assetsSlider.value = liabSlider.value = eqSlider.value = 0;
      [assetsSlider, liabSlider, eqSlider].forEach(s => {
        s.style.background = "rgba(255,255,255,.06)";
      });
      updateEqViz();
    }

    function clamp(v, min, max, step) {
      v = Math.max(min, Math.min(max, v));
      return Math.round(v / step) * step;
    }

    function syncFromAssets() {
      const A = parseInt(assetsSlider.value, 10);
      if (autoBalance) {
        let L = clamp(Math.round(A * leRatio), 0, 1000000, 1000);
        if (L > A) L = A;
        liabSlider.value = clamp(L, 0, 1000000, 1000);
        eqSlider.value   = clamp(A - L, 0, 1000000, 1000);
      }
      // update track fill for all sliders
      [assetsSlider, liabSlider, eqSlider].forEach(s => {
        const pct = ((s.value - s.min) / (s.max - s.min)) * 100;
        s.style.background = `linear-gradient(90deg, rgba(45,186,126,.35) ${pct}%, rgba(255,255,255,.06) ${pct}%)`;
      });
      updateEqViz();
    }

    function manualChange(changed) {
      const A = parseInt(assetsSlider.value, 10);
      if (autoBalance) {
        let L = parseInt(liabSlider.value, 10);
        let E = parseInt(eqSlider.value, 10);
        if (changed === 'L') { L = clamp(L, 0, A, 1000); E = A - L; }
        else { E = clamp(E, 0, A, 1000); L = A - E; }
        liabSlider.value = clamp(L, 0, 1000000, 1000);
        eqSlider.value   = clamp(E, 0, 1000000, 1000);
        leRatio = A > 0 ? (L / A) : 0.5;
        document.getElementById("eqHint").textContent = "Auto-Balance: when Liabilities rise, Equity falls. L + E always equals Assets.";
      }
      // update track fill
      [assetsSlider, liabSlider, eqSlider].forEach(s => {
        const pct = ((s.value - s.min) / (s.max - s.min)) * 100;
        s.style.background = `linear-gradient(90deg, rgba(45,186,126,.35) ${pct}%, rgba(255,255,255,.06) ${pct}%)`;
      });
      updateEqViz();
    }

    function updateEqViz() {
      const A = parseInt(assetsSlider.value, 10);
      const L = parseInt(liabSlider.value, 10);
      const E = parseInt(eqSlider.value, 10);
      document.getElementById("aVal").textContent = money(A);
      document.getElementById("lVal").textContent = money(L);
      document.getElementById("eVal").textContent = money(E);
      document.getElementById("eqLine").textContent = `ΔA (${money(A)}) = ΔL (${money(L)}) + ΔE (${money(E)})`;
      const balanced = A === L + E;
      const s = document.getElementById("eqStatus");
      s.textContent = balanced ? "Balanced ✓" : "Not Balanced ✗";
      s.style.color = balanced ? "var(--green)" : "var(--red)";

      // SHAKE when unbalanced
      if (!balanced) {
        triggerShake(document.getElementById("eqLine").closest(".eq-line-display"));
      }
    }

    // ===== Journal Entry Tool =====
    let J = { A: 0, L: 0, E: 0, entries: [] };

    function typeEffectOnALE(type, side, amount) {
      const d = side === "D";
      let dA=0, dL=0, dE=0;
      if (type === "Asset")     dA += (d ? +1 : -1) * amount;
      else if (type === "Liability") dL += (d ? -1 : +1) * amount;
      else dE += (d ? -1 : +1) * amount;
      return { dA, dL, dE };
    }

    function applyDelta(dA, dL, dE) {
      J.A = Math.max(0, J.A + dA);
      J.L = Math.max(0, J.L + dL);
      J.E = Math.max(0, J.E + dE);
    }

    function addEntry() {
      const debit = document.getElementById("debitType").value;
      const credit = document.getElementById("creditType").value;
      const amt = parseFloat(document.getElementById("jeAmount").value || "0");
      if (!amt || amt <= 0) { setJeStatus("Enter a valid amount.", "warn"); return; }
      const d1 = typeEffectOnALE(debit, "D", amt);
      const d2 = typeEffectOnALE(credit, "C", amt);
      const dA = d1.dA + d2.dA, dL = d1.dL + d2.dL, dE = d1.dE + d2.dE;
      applyDelta(dA, dL, dE);
      J.entries.push({ debit, credit, amt, dA, dL, dE, isNew: true });
      renderJournal();
      setJeStatus("Entry added ✓", "good");
      document.getElementById("jeAmount").value = "";
    }

    function undoEntry() {
      if (!J.entries.length) { setJeStatus("Nothing to undo.", "warn"); return; }
      // Flash the last row red before removing
      const body = document.getElementById("jeBody");
      const lastRow = body.querySelector("tr:last-child");
      if (lastRow && body.children.length > 0) {
        lastRow.classList.add("flash-red");
        setTimeout(() => {
          const last = J.entries.pop();
          applyDelta(-last.dA, -last.dL, -last.dE);
          renderJournal();
        }, 300);
      } else {
        const last = J.entries.pop();
        applyDelta(-last.dA, -last.dL, -last.dE);
        renderJournal();
      }
      setJeStatus("Undid last entry.", "good");
    }

    function resetJournal() {
      J = { A: 0, L: 0, E: 0, entries: [] };
      renderJournal();
      setJeStatus("Reset.", "good");
    }

    let jeStatusTimer;
    function setJeStatus(msg, cls) {
      const el = document.getElementById("jeStatus");
      el.textContent = msg;
      el.className = "result-badge show " + cls;
      clearTimeout(jeStatusTimer);
      jeStatusTimer = setTimeout(() => { el.className = "result-badge"; }, 2500);
    }

    function fmtSigned(n) {
      const sign = n > 0 ? "+" : (n < 0 ? "−" : "");
      return sign + "$" + Math.abs(n).toLocaleString(undefined, { maximumFractionDigits: 0 });
    }

    function renderJournal() {
      const fmt = n => "$" + Math.max(0, n).toLocaleString(undefined, { maximumFractionDigits: 0 });
      document.getElementById("balA").textContent = fmt(J.A);
      document.getElementById("balL").textContent = fmt(J.L);
      document.getElementById("balE").textContent = fmt(J.E);
      document.getElementById("balEqLine").textContent = `A (${fmt(J.A)}) = L (${fmt(J.L)}) + E (${fmt(J.E)})`;
      const body = document.getElementById("jeBody");
      body.innerHTML = "";
      if (!J.entries.length) {
        body.innerHTML = `<tr><td colspan="7" style="color:var(--muted2);text-align:center;padding:20px;">No entries yet.</td></tr>`;
        return;
      }
      J.entries.forEach((e, i) => {
        const cls = (n) => n > 0 ? "td-pos" : (n < 0 ? "td-neg" : "");
        const tr = document.createElement("tr");
        if (e.isNew) { tr.classList.add("flash-green"); e.isNew = false; }
        tr.innerHTML = `
          <td>${i+1}</td>
          <td>${escapeHtml(e.debit)}</td>
          <td>${escapeHtml(e.credit)}</td>
          <td>$${e.amt.toLocaleString()}</td>
          <td class="${cls(e.dA)}">${fmtSigned(e.dA)}</td>
          <td class="${cls(e.dL)}">${fmtSigned(e.dL)}</td>
          <td class="${cls(e.dE)}">${fmtSigned(e.dE)}</td>
        `;
        body.appendChild(tr);
      });
    }

    // ===== Auth Modal =====
    function openAuthModal() {
      document.getElementById('authModal').classList.add('open');
      document.body.style.overflow = 'hidden';
    }
    function closeAuthModal() {
      document.getElementById('authModal').classList.remove('open');
      document.body.style.overflow = '';
    }

    // ===== Profile Dropdown =====
    function toggleProfileDropdown() {
      const dd = document.getElementById('profileDropdown');
      if (!dd) return;
      dd.classList.toggle('open');
    }
    function closeProfileDropdown() {
      const dd = document.getElementById('profileDropdown');
      if (dd) dd.classList.remove('open');
    }
    document.addEventListener('click', e => {
      const wrap = document.querySelector('.nav-auth-wrap');
      if (wrap && !wrap.contains(e.target)) closeProfileDropdown();
    });
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') { closeAuthModal(); closeProfileDropdown(); }
    });

    // ===== Glossary =====
    const glossary = [
      ["Accounting", "An information system that provides reports to users about a business's economic activities and condition."],
      ["Accounting Equation", "Assets = Liabilities + Stockholders' Equity."],
      ["Assets", "Resources owned by a business."],
      ["Liabilities", "Amounts owed to creditors; claims of creditors."],
      ["Stockholders' Equity", "Owners' claim to the assets of a corporation."],
      ["Common Stock", "Owner investment in a corporation."],
      ["Retained Earnings", "Cumulative earnings kept in the business after dividends."],
      ["Dividends", "Distributions of earnings to stockholders; not an expense."],
      ["Accounts Receivable", "Amount due from customers for services or sales on credit."],
      ["Accounts Payable", "Amount owed to suppliers for purchases on account."],
      ["GAAP", "Generally Accepted Accounting Principles used for financial reporting in the U.S."],
      ["FASB", "Financial Accounting Standards Board, the primary U.S. standard setter."],
      ["SEC", "Securities and Exchange Commission; oversees reporting for public companies."],
      ["IASB", "International Accounting Standards Board; issues IFRS."],
      ["IFRS", "International Financial Reporting Standards used in many countries."],
      ["Relevance", "Information quality meaning it can influence decisions."],
      ["Faithful Representation", "Information quality meaning it reflects economic reality."],
      ["Monetary Unit Assumption", "Assumes transactions can be measured in a stable currency."],
      ["Time Period Assumption", "Allows reporting by month, quarter, or year."],
      ["Business Entity Assumption", "Separates the business from the owner's personal activities."],
      ["Going Concern Assumption", "Assumes the business will continue operating."],
      ["Historical Cost Principle", "Record assets at original transaction cost."],
      ["Revenue Recognition Principle", "Record revenue when earned."],
      ["Expense Recognition Principle", "Record expenses in the same period as related revenues."],
      ["Income Statement", "Statement showing revenues, expenses, and net income or loss for a period."],
      ["Retained Earnings Statement", "Statement showing the change in retained earnings for a period."],
      ["Balance Sheet", "Statement showing assets, liabilities, and stockholders' equity on a specific date."],
      ["Statement of Cash Flows", "Statement summarizing cash receipts and cash payments for a period."],
    ];

    const glossaryEl = document.getElementById("glossaryTerms");
    if (glossaryEl) {
      glossary.forEach(([term, def]) => {
        glossaryEl.innerHTML += `<div class="term"><span class="term-tag" style="white-space:normal;min-width:160px;">${term}</span><div class="term-body">${def}</div></div>`;
      });
    }

    // ===== Study Checklist =====
    const checklist = [
      "I can define accounting, business, service business, and profit.",
      "I can explain internal vs. external users of accounting information.",
      "I can describe why ethics matters in accounting.",
      "I can identify GAAP, FASB, SEC, and IASB/IFRS.",
      "I can explain relevance and faithful representation.",
      "I can list and explain the four accounting assumptions.",
      "I can explain measurement and historical cost.",
      "I can state and use the accounting equation.",
      "I can analyze transaction effects on the equation.",
      "I can explain Common Stock, Retained Earnings, and Dividends.",
      "I can list the four financial statements in order.",
      "I can explain how the statements connect and check for errors.",
    ];

    const checklistEl = document.getElementById("checklist");
    if (checklistEl) {
      checklist.forEach((item, i) => {
        const label = document.createElement("label");
        label.style.cssText = "display:flex;align-items:flex-start;gap:10px;cursor:pointer;font-size:13px;color:var(--muted);line-height:1.55;";
        label.innerHTML = `<input type="checkbox" style="margin-top:2px;accent-color:var(--green);width:14px;height:14px;flex-shrink:0;"> ${item}`;
        label.querySelector("input").addEventListener("change", function() {
          label.style.color = this.checked ? "var(--green)" : "var(--muted)";
          label.style.textDecoration = this.checked ? "line-through" : "none";
          if (typeof saveAllProgress === 'function') saveAllProgress();
          if (typeof updateProgressBar === 'function') updateProgressBar();
        });
        checklistEl.appendChild(label);
      });
    }

    // ===== Init everything =====
    renderChapters();
    resetSliders();
    renderJournal();
    document.getElementById("abBtn").classList.add("active");

    // Init slider glow on all range inputs
    document.querySelectorAll('input[type="range"]').forEach(initSliderGlow);

    // Init ambient animations
    initHeroParticles();
    initGradientShift();
    initFallingMoney();
    initCursorTrail();
    // ===== Chapter Select Modal =====
    function openChapterModal() {
      const list = document.getElementById("modalChapterList");
      list.innerHTML = "";
      chapters.forEach(ch => {
        const div = document.createElement("div");
        div.className = "modal-ch" + (ch.active ? " current" : "");
        div.innerHTML = `
          <span class="modal-ch-num">${String(ch.num).padStart(2,'0')}</span>
          <span class="modal-ch-title">${ch.num === 1 ? "Intro to Accounting & Business" : "Chapter " + ch.num}</span>
          <span class="modal-ch-badge ${ch.num === 1 ? 'live' : 'soon'}">${ch.num === 1 ? "Live" : "Soon"}</span>
        `;
        if (!ch.active) {
          div.onclick = () => {
            closeChapterModal();
            goChapter(ch.num);
          };
        }
        list.appendChild(div);
      });
      document.getElementById("chapterModal").classList.add("open");
      document.body.style.overflow = "hidden";
    }

    function closeChapterModal() {
      document.getElementById("chapterModal").classList.remove("open");
      document.body.style.overflow = "";
    }

    document.addEventListener("keydown", e => {
      if (e.key === "Escape") closeChapterModal();
    });

    // ===== Chapter Recap Quiz =====
    // Wire up option clicks
    document.querySelectorAll('.rq-options').forEach(group => {
      group.querySelectorAll('.rq-option').forEach(opt => {
        opt.addEventListener('click', () => {
          if (group.dataset.answered) return;
          group.querySelectorAll('.rq-option').forEach(o => o.classList.remove('selected'));
          opt.classList.add('selected');
          group.dataset.selected = opt.dataset.val;
        });
      });
    });

    function submitRecap() {
      const items = document.querySelectorAll('.rq-item');
      let score = 0;
      let answered = 0;

      items.forEach(item => {
        const group = item.querySelector('.rq-options');
        const feedback = item.querySelector('.rq-feedback');
        const selected = group.dataset.selected;
        const correct = group.dataset.correct;

        if (!selected) return;
        answered++;
        group.dataset.answered = '1';

        group.querySelectorAll('.rq-option').forEach(opt => {
          if (opt.dataset.val === correct) opt.classList.add('correct');
          else if (opt.dataset.val === selected && selected !== correct) opt.classList.add('wrong');
          opt.style.pointerEvents = 'none';
        });

        feedback.classList.add('show');
        if (selected === correct) {
          score++;
          feedback.classList.add('good');
        } else {
          feedback.classList.add('bad');
        }
      });

      if (answered < items.length) {
        const unanswered = items.length - answered;
        showToast(`Answer all ${unanswered} remaining question${unanswered > 1 ? 's' : ''} first.`);
        return;
      }

      const scoreEl = document.getElementById('recapScore');
      const scoreNum = document.getElementById('recapScoreNum');
      const scoreLabel = document.getElementById('recapScoreLabel');
      scoreNum.textContent = `${score}/10`;
      const pct = score / 10;
      if (pct >= 0.9) scoreLabel.textContent = "Excellent — you've mastered Chapter 1!";
      else if (pct >= 0.7) scoreLabel.textContent = 'Good work — review the questions you missed.';
      else scoreLabel.textContent = 'Keep studying — re-read the sections you missed.';
      scoreEl.classList.add('show');
      scoreEl.scrollIntoView({ behavior: 'smooth', block: 'center' });

      if (score >= 8) spawnConfetti(document.getElementById('recapSubmit'));

      document.getElementById('recapSubmit').disabled = true;
      if (typeof saveAllProgress === 'function') saveAllProgress();
    }

    // ===== MASTERY CHECK QUIZ =====

    // Section metadata — maps tag to section ID and display name
    const sectionMeta = {
      'bus':    { id: 'obj1', label: 'Business & Users (Sections 01–02)' },
      'ethics': { id: 'obj2', label: 'Ethics (Sections 03–04)' },
      'gaap':   { id: 'obj3', label: 'GAAP & Standards (Sections 05–06)' },
      'assump': { id: 'obj4', label: 'Assumptions & Principles (Sections 07–08)' },
      'eq':     { id: 'obj5', label: 'Accounting Equation (Sections 09–10)' },
      'trans':  { id: 'obj6', label: 'Transactions & Equity (Sections 11–12)' },
      'stmts':  { id: 'obj7', label: 'Financial Statements (Sections 13–17)' },
    };

    const masteryQuestions = [
      // Original 15
      { section:'eq',     q:"What is the accounting equation?", options:["Assets = Revenue \u2212 Expenses","Assets = Liabilities + Stockholders' Equity","Profit = Revenues \u2212 Expenses","Liabilities = Assets + Equity"], correct:1, explain:"Assets = Liabilities + Stockholders' Equity. Every transaction must keep this balanced." },
      { section:'bus',    q:"A service business is one that:", options:["Sells physical merchandise","Provides services rather than physical products","Manufactures goods in a factory","Only operates online"], correct:1, explain:"A service business provides services rather than selling physical goods." },
      { section:'gaap',   q:"Which organization writes most U.S. accounting standards?", options:["IRS","SEC","FASB","IASB"], correct:2, explain:"FASB (Financial Accounting Standards Board) develops GAAP in the U.S. The SEC enforces reporting but does not write the standards." },
      { section:'assump', q:"The business entity assumption means:", options:["The business will continue indefinitely","Transactions use a stable currency","Business records are kept separate from the owner's personal records","Results are reported for a specific period"], correct:2, explain:"Business entity: the business is treated as completely separate from its owner." },
      { section:'trans',  q:"Which is a contra equity account with a normal debit balance?", options:["Common Stock","Accounts Payable","Retained Earnings","Expenses"], correct:3, explain:"Expenses carry a debit balance — opposite of equity's normal credit. When expenses increase, net income falls, reducing Retained Earnings and equity." },
      { section:'trans',  q:"An owner invests $20,000 cash. Which accounts change?", options:["Cash up; Retained Earnings up","Cash up; Revenue up","Cash up; Common Stock up","Accounts Receivable up; Common Stock up"], correct:2, explain:"Owner investment = Cash (asset) up + Common Stock (equity) up." },
      { section:'assump', q:"The historical cost principle says assets should be recorded at:", options:["Current market value","Estimated resale value","Original transaction cost","Replacement cost"], correct:2, explain:"Historical cost: record assets at what you actually paid, regardless of later market changes." },
      { section:'trans',  q:"Dividends are best described as:", options:["An expense on the income statement","A distribution of earnings that reduces retained earnings","A liability owed to creditors","An increase to common stock"], correct:1, explain:"Dividends reduce Retained Earnings (equity) but are NOT expenses — they never appear on the income statement." },
      { section:'stmts',  q:"Which financial statement is prepared FIRST?", options:["Balance Sheet","Statement of Cash Flows","Retained Earnings Statement","Income Statement"], correct:3, explain:"Income Statement first — its net income is needed for the Retained Earnings Statement, which is needed before the Balance Sheet." },
      { section:'stmts',  q:"The balance sheet reports on:", options:["A period of time","A specific single date","The prior fiscal year only","A projected future date"], correct:1, explain:"The balance sheet is a snapshot — it shows financial position on one specific date." },
      { section:'trans',  q:"Buying equipment on account affects which accounts?", options:["Equipment up; Cash down","Equipment up; Accounts Payable up","Cash down; Accounts Payable down","Equipment down; Retained Earnings up"], correct:1, explain:"Equipment (asset) up and Accounts Payable (liability) up. No cash changes yet." },
      { section:'assump', q:"Which assumption allows quarterly reporting?", options:["Going concern","Monetary unit","Business entity","Time period"], correct:3, explain:"The time period assumption divides activity into specific reporting periods." },
      { section:'stmts',  q:"Net income flows directly from the income statement to the:", options:["Balance sheet","Statement of cash flows","Retained earnings statement","General ledger"], correct:2, explain:"Net income flows to the retained earnings statement, which then flows to the balance sheet." },
      { section:'gaap',   q:"Faithful representation means financial information:", options:["Influences a user's decision","Accurately reflects what actually happened","Is reported every quarter","Was audited by a CPA"], correct:1, explain:"Faithful representation means the numbers reflect economic reality." },
      { section:'trans',  q:"Revenues $45,000, expenses $31,000. Net income is:", options:["$76,000","$31,000","$14,000","$45,000"], correct:2, explain:"$45,000 \u2212 $31,000 = $14,000. Net Income = Revenues \u2212 Expenses." },
      // 50-question bank (answers per provided key)
      { section:'bus',    q:"Accounting is best defined as:", options:["A system only for taxes","An information system that reports a business's economic activities","A way to track only cash","A method for banks only"], correct:1, explain:"Accounting is an information system that identifies, records, and communicates economic activities to interested users." },
      { section:'bus',    q:"Which is an external user of accounting information?", options:["Store manager","Department supervisor","Investor","Company president"], correct:2, explain:"Investors are outside the business and use reports to evaluate investments. Managers, supervisors, and presidents are internal users." },
      { section:'gaap',   q:"Which organization primarily develops U.S. accounting standards?", options:["IRS","FASB","SEC","GAAP"], correct:1, explain:"FASB develops U.S. GAAP. The SEC enforces reporting but does not write the standards." },
      { section:'assump', q:"Which is NOT a standard accounting assumption or principle?", options:["Time period assumption","Monetary unit assumption","Color-coding assumption","Going concern assumption"], correct:2, explain:"There is no color-coding assumption. The four are monetary unit, time period, business entity, and going concern." },
      { section:'eq',     q:"The accounting equation is:", options:["Assets = Liabilities + Stockholders' Equity","Assets = Revenue + Expenses","Cash = Liabilities + Dividends","Revenue = Expenses + Equity"], correct:0, explain:"Assets = Liabilities + Stockholders' Equity is the foundation of all accounting." },
      { section:'trans',  q:"If a company pays a liability on account:", options:["Assets increase; liabilities increase","Assets decrease; liabilities decrease","Equity increases; liabilities decrease","Revenues increase; assets increase"], correct:1, explain:"Cash (asset) decreases and Accounts Payable (liability) decreases. Both sides go down equally." },
      { section:'trans',  q:"Dividends are:", options:["An expense","A liability","A distribution of earnings to stockholders","Revenue"], correct:2, explain:"Dividends are distributions of earnings to stockholders — they reduce Retained Earnings but are never an expense." },
      { section:'stmts',  q:"Which financial statement is prepared first?", options:["Balance sheet","Income statement","Statement of cash flows","Retained earnings statement"], correct:1, explain:"The income statement is prepared first. Net income is needed before completing the retained earnings statement." },
      { section:'assump', q:"The principle that says revenue is recorded when earned is:", options:["Expense recognition principle","Revenue recognition principle","Historical cost principle","Full disclosure principle"], correct:1, explain:"Revenue recognition: record revenue when earned, not necessarily when cash is received." },
      { section:'stmts',  q:"If ending cash on the SCF doesn't match cash on the balance sheet:", options:["That is normal","No issue exists","An error likely occurred","Only the income statement is affected"], correct:2, explain:"Ending cash on the statement of cash flows must equal cash on the balance sheet. A mismatch means there is an error." },
      { section:'eq',     q:"Assets are best defined as:", options:["Amounts owed to creditors","Resources owned by a business","Owner withdrawals","Profits earned this year"], correct:1, explain:"Assets are resources owned or controlled by the business that provide future economic benefits." },
      { section:'eq',     q:"Liabilities are:", options:["Resources the business controls","Amounts owed by the business","Owner investments","Revenues earned"], correct:1, explain:"Liabilities are obligations — amounts the business owes to others." },
      { section:'eq',     q:"Stockholders' equity represents:", options:["Total cash in the business","Creditors' claims on assets","Owners' claim on assets","Only common stock"], correct:2, explain:"Stockholders' equity is the owners' residual claim after all liabilities have been satisfied." },
      { section:'stmts',  q:"Which statement reports revenues and expenses?", options:["Balance sheet","Income statement","Statement of retained earnings","Statement of cash flows"], correct:1, explain:"The income statement summarizes revenues and expenses and calculates net income or net loss." },
      { section:'stmts',  q:"Which statement shows assets, liabilities, and equity at a point in time?", options:["Income statement","Balance sheet","Statement of cash flows","Retained earnings statement"], correct:1, explain:"The balance sheet is a snapshot on one specific date — not over a period." },
      { section:'stmts',  q:"Which statement explains changes in retained earnings?", options:["Balance sheet","Income statement","Statement of retained earnings","Statement of owner withdrawals"], correct:2, explain:"The retained earnings statement: Beginning RE + Net Income \u2212 Dividends = Ending RE." },
      { section:'stmts',  q:"Which statement reports cash from operating, investing, and financing activities?", options:["Income statement","Statement of retained earnings","Statement of cash flows","Balance sheet"], correct:2, explain:"The statement of cash flows has three sections: operating, investing, and financing." },
      { section:'trans',  q:"A business purchases supplies for cash. The effect is:", options:["Assets increase; liabilities increase","One asset increases; another asset decreases","Equity increases; assets decrease","Revenues increase; assets increase"], correct:1, explain:"Supplies (asset) up and Cash (asset) down. Total assets stay the same — just a shift within assets." },
      { section:'trans',  q:"A business purchases equipment on account. The effect is:", options:["Assets increase; liabilities increase","Assets decrease; liabilities decrease","Equity increases; liabilities increase","Revenues increase; assets decrease"], correct:0, explain:"Equipment (asset) up and Accounts Payable (liability) up. Both sides rise equally." },
      { section:'trans',  q:"A business earns revenue in cash. The effect is:", options:["Assets increase; equity increases","Assets increase; liabilities increase","Assets decrease; equity decreases","Liabilities decrease; equity increases"], correct:0, explain:"Cash (asset) up and Revenue (equity) up. Earning cash grows both sides." },
      { section:'trans',  q:"A business pays wages expense in cash. The effect is:", options:["Assets increase; equity increases","Assets decrease; equity decreases","Liabilities decrease; equity increases","Assets decrease; liabilities decrease"], correct:1, explain:"Cash (asset) down and Wages Expense (contra equity) up, reducing net income and equity." },
      { section:'trans',  q:"A business receives cash from issuing common stock. The effect is:", options:["Assets increase; equity increases","Assets increase; liabilities increase","Assets decrease; equity increases","Equity decreases; liabilities increase"], correct:0, explain:"Cash (asset) up and Common Stock (equity) up. Issuing stock grows both sides equally." },
      { section:'trans',  q:"A business pays dividends in cash. The effect is:", options:["Assets decrease; liabilities decrease","Assets decrease; equity decreases","Assets increase; equity decreases","Liabilities increase; equity decreases"], correct:1, explain:"Cash (asset) down and Dividends (contra equity) up, reducing Retained Earnings." },
      { section:'trans',  q:"Which of the following is a liability?", options:["Accounts Receivable","Supplies","Accounts Payable","Fees Earned"], correct:2, explain:"Accounts Payable is what the business owes to suppliers. The others are assets or revenue." },
      { section:'trans',  q:"Which of the following is an asset?", options:["Wages Expense","Accounts Payable","Accounts Receivable","Dividends"], correct:2, explain:"Accounts Receivable is money customers owe the business — an asset." },
      { section:'trans',  q:"Which is a stockholders' equity account?", options:["Common Stock","Accounts Payable","Rent Expense","Supplies"], correct:0, explain:"Common Stock represents owner investment — a stockholders' equity account." },
      { section:'trans',  q:"Which is a revenue account?", options:["Wages Expense","Fees Earned","Dividends","Accounts Receivable"], correct:1, explain:"Fees Earned is revenue — it increases equity when services are performed." },
      { section:'trans',  q:"Which is an expense account?", options:["Common Stock","Fees Earned","Rent Expense","Accounts Payable"], correct:2, explain:"Rent Expense is an expense — debit balance, reduces net income and equity." },
      { section:'assump', q:"The time period assumption allows a business to:", options:["Ignore expenses","Report information for specific periods","Combine personal and business records","Record only cash transactions"], correct:1, explain:"The time period assumption divides activity into reporting periods — monthly, quarterly, annually." },
      { section:'assump', q:"The monetary unit assumption means:", options:["Only foreign currency can be used","Accounting records use a stable currency unit","Inflation is recorded daily","Only cash is recorded"], correct:1, explain:"All transactions are measured and recorded in a stable monetary unit (dollars in the U.S.)." },
      { section:'assump', q:"The going concern assumption means a business is assumed to:", options:["Close at year end","Continue operating in the future","Never borrow money","Always earn a profit"], correct:1, explain:"Going concern: the business will keep operating indefinitely, justifying long-term asset recording at cost." },
      { section:'ethics', q:"Why is ethics important in accounting?", options:["To make reports look better","To ensure trustworthy financial information","To reduce all expenses","To eliminate taxes"], correct:1, explain:"Accounting only works when users trust the information. Unethical reporting harms lenders, investors, and employees." },
      { section:'bus',    q:"Managerial accounting information is mainly used by:", options:["Investors and creditors","Internal managers","Government agencies only","Customers"], correct:1, explain:"Managerial accounting provides detailed internal reports for managers. External users rely on financial accounting." },
      { section:'bus',    q:"Financial accounting mainly focuses on:", options:["Internal planning reports only","External reports for users outside the company","Daily employee schedules","Production methods"], correct:1, explain:"Financial accounting produces standardized external reports for investors, creditors, and regulators." },
      { section:'bus',    q:"Which is an example of an internal user?", options:["Investor","Bank lender","Production supervisor","Supplier"], correct:2, explain:"A production supervisor works inside the business. Investors, bank lenders, and suppliers are external users." },
      { section:'bus',    q:"Which is an example of an external user?", options:["Department manager","Store cashier","Creditor","Operations supervisor"], correct:2, explain:"A creditor is outside the business and uses financial statements to evaluate lending risk." },
      { section:'eq',     q:"If assets are $145,000 and liabilities are $52,000, stockholders' equity is:", options:["$93,000","$197,000","$52,000","$145,000"], correct:0, explain:"Equity = Assets \u2212 Liabilities = $145,000 \u2212 $52,000 = $93,000." },
      { section:'trans',  q:"Net income is calculated as:", options:["Assets \u2212 Liabilities","Revenues \u2212 Expenses","Cash + Receivables","Liabilities + Equity"], correct:1, explain:"Net Income = Revenues \u2212 Expenses. The bottom line of the income statement." },
      { section:'trans',  q:"If revenues are greater than expenses, the business has:", options:["A net loss","A liability","Net income","Dividends"], correct:2, explain:"Revenues exceeding expenses = net income. The opposite = net loss." },
      { section:'trans',  q:"If expenses are greater than revenues, the business has:", options:["Net income","Net loss","Retained earnings","Assets"], correct:1, explain:"Expenses exceeding revenues = net loss, which reduces Retained Earnings and equity." },
      { section:'stmts',  q:"Beginning Retained Earnings + Net Income \u2212 Dividends =", options:["Ending Assets","Ending Liabilities","Ending Retained Earnings","Ending Revenue"], correct:2, explain:"The retained earnings formula. The ending balance flows to the balance sheet." },
      { section:'stmts',  q:"Which statement is directly linked to the balance sheet through retained earnings?", options:["Income statement","Statement of retained earnings","Statement of cash flows only","Trial balance"], correct:1, explain:"The retained earnings statement produces ending RE that appears directly on the balance sheet." },
      { section:'stmts',  q:"Which is one section of the statement of cash flows?", options:["Revenue activities","Expense activities","Operating activities","Equity activities"], correct:2, explain:"Operating activities cover cash from day-to-day business operations." },
      { section:'stmts',  q:"Which is another section of the statement of cash flows?", options:["Investing activities","Sales activities","Profit activities","Retained activities"], correct:0, explain:"Investing activities cover cash flows for long-term assets." },
      { section:'stmts',  q:"Which is the third section of the statement of cash flows?", options:["Financing activities","Collection activities","Earning activities","Posting activities"], correct:0, explain:"Financing activities cover cash flows with owners and lenders." },
      { section:'assump', q:"The expense recognition (matching) principle means expenses should be recorded:", options:["When cash is paid only","In the same period as the related revenue","At year end only","Only when approved by management"], correct:1, explain:"Match expenses to the same period as the revenues they helped generate." },
      { section:'trans',  q:"A business earns revenue on account. The effect is:", options:["Assets increase; equity increases","Assets increase; liabilities increase","Assets decrease; equity increases","Liabilities decrease; equity decreases"], correct:0, explain:"Accounts Receivable (asset) up and Revenue (equity) up." },
      { section:'trans',  q:"A business collects cash from a customer on account. The effect is:", options:["Assets increase; equity increases","One asset increases; another asset decreases","Liabilities decrease; equity increases","Equity decreases; assets decrease"], correct:1, explain:"Cash up and Accounts Receivable down — converting one asset to another." },
      { section:'eq',     q:"Which would most likely cause an accounting equation imbalance?", options:["Recording only one side of a transaction","Using dollar signs","Writing a date on the statement","Listing assets before liabilities"], correct:0, explain:"Recording only one side breaks the balance. The other choices are formatting only." },
      { section:'stmts',  q:"Which statement is most accurate?", options:["The income statement is prepared after the balance sheet","Dividends are an expense on the income statement","Financial statements are interrelated","Cash flow totals do not need to match ending cash"], correct:2, explain:"The four statements are interrelated — each one feeds into the next, and ending cash must match across statements." },
    ];

    let masteryState = { current: 0, score: 0, answered: false, order: [], missed: [] };

    function openMasteryModal() {
      const shuffled = [...masteryQuestions.keys()].sort(() => Math.random() - 0.5).slice(0, 15);
      masteryState = { current: 0, score: 0, answered: false, order: shuffled, missed: [] };
      renderMasteryQuestion();
      document.getElementById('masteryOverlay').classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    function closeMasteryModal() {
      document.getElementById('masteryOverlay').classList.remove('open');
      document.body.style.overflow = '';
    }

    function renderMasteryQuestion() {
      const total   = 15;
      const idx     = masteryState.order[masteryState.current];
      const q       = masteryQuestions[idx];
      const num     = masteryState.current + 1;
      const letters = ['A','B','C','D'];

      document.getElementById('masteryProgressFill').style.width = ((masteryState.current / total) * 100) + '%';
      document.getElementById('masterySubtitle').textContent =
        `Question ${num} of ${total}  \u00b7  Score: ${masteryState.score}/${masteryState.current}`;

      document.getElementById('masteryBody').innerHTML =
        '<div class="mq-counter">Question ' + num + ' / ' + total + '</div>' +
        '<div class="mq-question">' + q.q + '</div>' +
        '<div class="mq-options" id="mqOptions">' +
        q.options.map((opt, i) =>
          '<div class="mq-option" onclick="selectMasteryAnswer(' + i + ')">' +
          '<span class="mq-letter">' + letters[i] + '</span>' + opt + '</div>'
        ).join('') +
        '</div>' +
        '<div class="mq-explanation" id="mqExplain">' + q.explain + '</div>' +
        '<button class="mq-next-btn" id="mqNext" onclick="nextMasteryQuestion()">' +
        (num === total ? 'See Results' : 'Next Question \u2192') + '</button>';

      masteryState.answered = false;
    }

    function selectMasteryAnswer(chosen) {
      if (masteryState.answered) return;
      masteryState.answered = true;
      const q       = masteryQuestions[masteryState.order[masteryState.current]];
      const correct = q.correct;
      const options = document.querySelectorAll('.mq-option');
      options.forEach((opt, i) => {
        opt.classList.add('locked');
        if (i === correct) opt.classList.add(i === chosen ? 'correct' : 'reveal-correct');
        else if (i === chosen) opt.classList.add('wrong');
      });
      const isCorrect = chosen === correct;
      if (isCorrect) {
        masteryState.score++;
      } else {
        if (!masteryState.missed.includes(q.section)) masteryState.missed.push(q.section);
      }
      const explain = document.getElementById('mqExplain');
      explain.classList.add('show', isCorrect ? 'good' : 'bad');
      document.getElementById('mqNext').classList.add('show');
      if (isCorrect) spawnConfetti(options[chosen]);
    }

    function nextMasteryQuestion() {
      masteryState.current++;
      if (masteryState.current >= 15) renderMasteryResult();
      else renderMasteryQuestion();
    }

    function renderMasteryResult() {
      const score = masteryState.score;
      const total = 15;
      const pct   = score / total;
      document.getElementById('masteryProgressFill').style.width = '100%';
      document.getElementById('masterySubtitle').textContent = 'Completed \u00b7 ' + score + '/' + total + ' correct';

      const grade = pct >= 0.9
        ? { label: 'Mastered!',     msg: 'Outstanding \u2014 you have a strong command of Chapter 1.', ring: 'pass' }
        : pct >= 0.7
        ? { label: 'Almost There',  msg: 'Solid foundation. Focus on the sections highlighted below.', ring: 'pass' }
        : { label: 'Keep Studying', msg: 'Re-read the sections flagged below \u2014 each one links to the lesson.', ring: 'fail' };

      let reviewHtml = '';
      if (masteryState.missed.length > 0) {
        const items = masteryState.missed.map(key => {
          const meta = sectionMeta[key];
          return '<div class="review-item" onclick="closeMasteryModal();setTimeout(()=>jumpTo(\'' + meta.id + '\'),200)">' +
            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>' +
            meta.label + '</div>';
        }).join('');
        reviewHtml = '<div class="review-sections"><div class="review-label">Study these sections</div>' + items + '</div>';
      }

      document.getElementById('masteryBody').innerHTML =
        '<div class="mastery-result">' +
        '<div class="mastery-result-ring ' + grade.ring + '">' + score + '/' + total + '</div>' +
        '<h3>' + grade.label + '</h3>' +
        '<p>' + grade.msg + '</p>' +
        reviewHtml +
        '<div class="mastery-result-btns">' +
        '<button class="mq-retry-btn" onclick="openMasteryModal()">New Quiz</button>' +
        '<button class="mq-done-btn" onclick="closeMasteryModal()">Done</button>' +
        '</div></div>';

      if (pct >= 0.7) spawnConfetti(document.getElementById('masteryBody'));
    }

  </script>
</body>
</html>
